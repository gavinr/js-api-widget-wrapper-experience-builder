define(["jimu-core"],(function(e){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=47)}({0:function(t,o){t.exports=e},13:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={previousView:"Previous view",nextView:"Next view",originTL:"Top left as origin",originTR:"Top right as origin",originBL:"Bottom left as origin",originBR:"Bottom right as origin",alignLeft:"Align left",alignRight:"Align right",alignTop:"Align top",alignCenter:"Align center",alignHCenter:"Horizontal center",alignVCenter:"Vertical center",alignBottom:"Align bottom",alignStretch:"Align stretch",sendBackward:"Send backward",bringForward:"Bring forward",sendToBack:"Send to back",bringToFront:"Bring to front",zoomoutFixed:"Zoom out fixed",order:"Order",moveToLeft:"Move to left",moveToRight:"Move to right",moveToTop:"Move to top",moveToBottom:"Move to bottom",addView:"Add view",deleteView:"Delete view",duplicateView:"Duplicate view",close:"Close",border:"Border",borderRadius:"Border radius",boxShadow:"Box shadow",insertABlock:"Insert block",moveup:"Move up",movedown:"Move down",chooseTemplate:"Choose a page template",chooseHeaderTemplate:"Choose a header template",chooseFooterTemplate:"Choose a footer template",dropWidgetToAdd:"Drag widget here",snapToLeft:"Snap to left",snapToTop:"Snap to top",snapToBottom:"Snap to bottom",snapToRight:"Snap to right",fullWidth:"Full width",fullHeight:"Full height",fullSize:"Full size",restoreSize:"Restore size",pendingTip:"Move to the pending list",setting:"Settings",dragToMove:"Drag to move",lockLayout:"Lock position and size",unlockLayout:"Unlock position and size",editHeader:"Edit header",editFooter:"Edit footer"}},21:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.BringForward=0]="BringForward",e[e.SendBackward=1]="SendBackward",e[e.BringToFront=2]="BringToFront",e[e.SendToBack=3]="SendToBack"}(t.OrderAdjustType||(t.OrderAdjustType={})),t.COLS_IN_ONE_ROW=12,t.CONTEXT_MENU_ITEM_SIZE=28,t.CONTEXT_MENU_ICON_SIZE=16,t.MIN_LAYOUT_ITEM_SIZE=16,t.CLICK_TOLRERANCE=5,function(e){e.Auto="auto",e[e.Normal=0]="Normal",e[e.BoundaryDropArea=10]="BoundaryDropArea",e[e.DragMoveTip=20]="DragMoveTip",e[e.HandlerTools=30]="HandlerTools",e[e.DraggingItem=40]="DraggingItem"}(t.LayoutZIndex||(t.LayoutZIndex={}))},4:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=o(5);function r(e,t){var o,i,r,d=n.getAppStore().getState(),u=null===(r=null===(i=null===(o=d)||void 0===o?void 0:o.appConfig)||void 0===i?void 0:i.layouts)||void 0===r?void 0:r[e];if(!u)return null;var l={layoutId:e,depth:t>=0?t+1:0,children:[]};return Object.keys(u.content||{}).sort().forEach((function(e){var t,o,i,r,s,p,f,g,c=u.content[e];if(c.type===n.LayoutItemType.Widget){var v=null===(r=null===(i=null===(o=null===(t=d)||void 0===t?void 0:t.appConfig)||void 0===o?void 0:o.widgets)||void 0===i?void 0:i[c.widgetId])||void 0===r?void 0:r.layouts;v&&Object.keys(v).sort().forEach((function(t){var o=v[t];a(l,o,e)}))}else if(c.type===n.LayoutItemType.Section){var m=null===(g=null===(f=null===(p=null===(s=d)||void 0===s?void 0:s.appConfig)||void 0===p?void 0:p.sections)||void 0===f?void 0:f[c.sectionId])||void 0===g?void 0:g.views;m&&[].concat(m).sort().forEach((function(t){var o,n,i,r,u=null===(r=null===(i=null===(n=null===(o=d)||void 0===o?void 0:o.appConfig)||void 0===n?void 0:n.views)||void 0===i?void 0:i[t])||void 0===r?void 0:r.layout;a(l,u,e)}))}})),l}function a(e,t,o){Object.keys(t||{}).sort().forEach((function(n){var i=r(t[n],e.depth);i&&(i.parentNode=e,i.itemIdInParent=o,e.children.push(i))}))}t.removeItemFromParent=function(e,t,o){var i=e.layoutId,r=e.layoutItemId;if(!o[i])return o;if(!o[i].content[r])return o;var a=o[i],d=n.Immutable(o);if(a.order&&a.order.indexOf(r)>=0){var u=[];a.order.forEach((function(e){e!==r&&u.push(e)})),d=d.setIn([i,"order"],u)}return t&&(d=d.setIn([i,"content"],d[i].content.without(r))),d},t.createEmptyLayoutItem=function(e,t){var o=i.getMaximumId(t[e])+1,r=n.Immutable(t),a={id:""+o};return r=r.setIn([e,"content",a.id],a),{layoutInfo:{layoutId:e,layoutItemId:a.id},layouts:r}},t.findLayoutItem=function(e,t){var o,n,i;if(!t)return null;var r=t.layoutId,a=t.layoutItemId;return null===(i=null===(n=null===(o=e.layouts)||void 0===o?void 0:o[r])||void 0===n?void 0:n.content)||void 0===i?void 0:i[a]},t.getMaximumLayoutItemId=function(e){return i.getMaximumId(e)},t.findLowestCommonAncestor=function(e,t){if(!e.parentNode){for(var o=t;o&&o.parentNode.layoutId!==e.layoutId;)o=o.parentNode;return{ancestor:e,itemIdForNode1:null,itemIdForNode2:o.itemIdInParent}}if(!t.parentNode){for(o=e;o&&o.parentNode.layoutId!==t.layoutId;)o=o.parentNode;return{ancestor:t,itemIdForNode1:o.itemIdInParent,itemIdForNode2:null}}if(e.parentNode.layoutId===t.layoutId)return{ancestor:t,itemIdForNode1:e.itemIdInParent,itemIdForNode2:null};if(e.layoutId===t.parentNode.layoutId)return{ancestor:e,itemIdForNode1:null,itemIdForNode2:t.itemIdInParent};for(var n=e.depth>=t.depth,i=n?e:t,r=n?t:e;i.depth>r.depth;)i=i.parentNode;for(;r.parentNode;){if(r.parentNode.layoutId===i.parentNode.layoutId)return{ancestor:r.parentNode,itemIdForNode1:n?i.itemIdInParent:r.itemIdInParent,itemIdForNode2:n?r.itemIdInParent:i.itemIdInParent};r=r.parentNode,i=i.parentNode}return null},t.findNodeInLayoutTree=function(e,t){for(var o=[e];o.length>0;){var n=o.pop();if(n.layoutId===t)return n;n.children.length>0&&(o=o.concat(n.children))}return null},t.findLowestAncestor=function(e,t){for(var o=e;o.parentNode&&o.parentNode.parentNode;){if(o.parentNode.layoutId===t)return o;o=o.parentNode}return o},t.generateLayoutTree=r},47:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(48),i=o(4);t.layoutUtils=i;var r=o(49);t.PageContext=r.PageContext,t.PageContextProps=r.PageContextProps;var a=o(50);t.LayoutContext=a.LayoutContext,t.LayoutContextProps=a.LayoutContextProps;var d=o(13);t.defaultMessages=d.default;var u=o(51);t.registerLayoutBuilder=u.registerLayoutBuilder,t.registerLayoutViewer=u.registerLayoutViewer,t.findLayoutBuilder=u.findLayoutBuilder,t.findLayoutViewer=u.findLayoutViewer;var l=o(5);t.autoBindHandlers=l.autoBindHandlers,t.mapStateToLayoutProps=l.mapStateToLayoutProps,t.mapStateToWidgetProps=l.mapStateToWidgetProps,t.mapStateToLayoutItemProps=l.mapStateToLayoutItemProps,t.replaceBoundingBox=l.replaceBoundingBox,t.getBuilderThemeVariables=l.getBuilderThemeVariables,t.isPercentage=l.isPercentage,t.isNumber=l.isNumber,t.relativeClientRect=l.relativeClientRect,t.getSectionInfo=l.getSectionInfo,t.findContainerWidgetId=l.findContainerWidgetId,t.fromRatio=l.fromRatio,t.toRatio=l.toRatio,t.getMaximumId=l.getMaximumId,t.parseTranslateCoords=l.parseTranslateCoords,t.isWidgetHasEmbeddedLayout=l.isWidgetHasEmbeddedLayout,t.isFunctionalWidget=l.isFunctionalWidget,t.getSizemodeLayoutOfView=l.getSizemodeLayoutOfView,t.isRTL=l.isRTL,t.parseAspectRatio=l.parseAspectRatio,t.getHeightOfLayoutItems=l.getHeightOfLayoutItems,t.calRowItemHeight=l.calRowItemHeight,function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(21)),t.init=function(){return Promise.all([n.loadMessage()])}},48:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=o(13);t.loadMessage=function(){var e=n.getAppStore().getState().appContext.locale;return(e=n.i18n.getLocaleToLoad(e,n.translatedLocales))?n.i18n.loadLocaleMessages("jimu-layouts/lib/translations",e).then((function(e){return n.getAppStore().dispatch(n.appActions.i18nMessagesLoaded("jimu-layouts",e)),e})):Promise.resolve(i.default)}},49:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0);t.PageContext=n.React.createContext({viewOnly:!0,isDesignMode:!0,mainSizeMode:n.BrowserSizeMode.Large,browserSizeMode:n.BrowserSizeMode.Large})},5:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0);function i(e){return"string"==typeof e&&e.length>1&&"%"===e[e.length-1]&&r(+e.slice(0,e.length-1))}function r(e){return!isNaN(parseFloat(e))&&isFinite(e)}function a(e,t){return parseFloat(""+e)*t/100}function d(e,t,o,n){if(null==t[e]||"auto"===t[e])return t;return i(t[e])?"left"===e||"right"===e||"width"===e?i(o)?t.set(e,o):t.set(e,(100*+o/n.width).toFixed(4)+"%"):i(o)?t.set(e,o):t.set(e,(100*+o/n.height).toFixed(4)+"%"):i(o)?"left"===e||"right"===e||"width"===e?t.set(e,Math.round(parseFloat(""+o)*n.width/100)):t.set(e,Math.round(parseFloat(""+o)*n.height/100)):isNaN(+o)?t.without(e):t.set(e,Math.round(+o)+"px")}function u(e,t){var o,n=e.widgets||{};return Object.keys(n).some((function(n){var i=e.widgets[n];return Object.keys(i.layouts||[]).some((function(e){var r=i.layouts[e];return Object.keys(r).some((function(e){if(r[e]===t)return o=n,!0}))}))})),o}function l(e,t){var o,i,r,a,d,u,l;return null!=(l=null===(u=null===(d=null===(a=null===(r=null===(i=null===(o=t||n.getAppStore().getState())||void 0===o?void 0:o.appConfig)||void 0===i?void 0:i.widgets)||void 0===r?void 0:r[e])||void 0===a?void 0:a.manifest)||void 0===d?void 0:d.properties)||void 0===u?void 0:u.hasEmbeddedLayout)&&l}function s(e,t){var o,i,r,a,d;return(null===(d=null===(a=null===(r=null===(i=null===(o=t||n.getAppStore().getState())||void 0===o?void 0:o.appConfig)||void 0===i?void 0:i.widgets)||void 0===r?void 0:r[e])||void 0===a?void 0:a.manifest)||void 0===d?void 0:d.widgetType)!==n.WidgetType.Layout}function p(e,t,o){var n,r,d,u,l,s,p=e.widgets[o];if(p){var f=(null===(d=null===(r=null===(n=p.config)||void 0===n?void 0:n.style)||void 0===r?void 0:r.padding)||void 0===d?void 0:d.number)||[0],g=(s=f)&&0!==s.length?1===s.length?[s[0],s[0],s[0],s[0]]:2===s.length?[s[0],s[1],s[0],s[1]]:3===s.length?[s[0],s[1],s[2],0]:[s[0],s[1],s[2],s[3]]:[0,0,0,0],c=(null===(l=null===(u=t)||void 0===u?void 0:u[o])||void 0===l?void 0:l.height)||0,v=g[0],m=g[2];return i(v)&&(v=a(v,c)),i(m)&&(m=a(m,c)),c-v-m}return 0}function f(e,t){var o,n,r,d,u,l=null!=(o=t.setting)?o:{};if(l.autoHeight||(null===(n=l.autoProps)||void 0===n?void 0:n.height))return{setting:{autoHeight:!0,autoProps:{height:!0}}};if("ratio"===l.heightMode)u={setting:{heightMode:"ratio",aspectRatio:l.aspectRatio,autoHeight:!1,autoProps:{height:!1}}};else{var s=null!=(d=null===(r=t.bbox)||void 0===r?void 0:r.height)?d:e;i(s)&&(s=a(s,e)),u={height:s,setting:{heightMode:"fixed",autoHeight:!1,autoProps:{height:!1}}}}return u}t.emptyFunc=function(){},t.autoBindHandlers=function(e,t){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))},t.toPixelUnit=function(e){if(r(e))return e;if("string"==typeof e){var t=parseFloat(e)/100;if(/\d+vh$/.test(e))return t*(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight);if(/\d+vw$/.test(e))return t*(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)}return 0},t.getSectionInfo=function(e,t){var o=e.appConfig.sections[t];if(!o||!o.views)return null;var n=e.appRuntimeInfo.currentViewIds&&e.appRuntimeInfo.currentViewIds.find((function(e){return o.views.indexOf(e)>-1}))||o.views[0];return{sectionId:t,views:o.views,activeView:e.appConfig.views[n],sectionStyle:o.style}},t.getSizemodeLayoutOfView=function(e){var t,o,i;return null===(i=null===(o=null===(t=n.getAppStore().getState().appConfig)||void 0===t?void 0:t.views)||void 0===o?void 0:o[e])||void 0===i?void 0:i.layout},t.getMaximumId=function(e){var t=-1;return e.content&&Object.keys(e.content).forEach((function(e){var o=parseInt(e,10);o>t&&(t=o)})),t},t.isPercentage=i,t.isNumber=r,t.toRatio=function(e,t){return(100*e/t).toFixed(4)+"%"},t.fromRatio=a,t.mapStateToLayoutProps=function(e,t){var o=n.utils.findLayoutId(t.layouts,e.browserSizeMode,e.appConfig.mainSizeMode),i=e.appConfig.layouts;return i[o]?{layout:i[o]}:{layout:null}},t.mapStateToLayoutItemProps=function(e,t){var o,n=t.layoutId,i=e.appConfig.layouts;if(!i[n])return{layoutItem:null,selected:!1};var r,a=!1,d=i[n],u=t.layoutItemId,l=d.content[u],s=!1;l&&(s=Boolean(l.isPending));var p=null===(o=e.appRuntimeInfo)||void 0===o?void 0:o.selection;p&&(a=p.layoutId===t.layoutId&&p.layoutItemId===l.id,r=p.autoScroll);var f={selected:a,layoutItem:s?null:l};return a&&(f.autoScroll=r),f},t.getActiveLayout=function(e){var t,o;e||(e=n.getAppStore().getState().appStateInBuilder),t=e.appRuntimeInfo,o=e.appConfig;var i=t.activeLayout,r=t.currentDialogId,a=t.currentPageId;if(i)return i;var d=void 0;if(a)if(o.pages[a])d=o.pages[a].layout;else{var u=Object.keys(o.pages);d=o.pages[u[0]].layout}else d=r?o.dialogs[r].layout:o.pages.default.layout;return d},t.mapStateToWidgetProps=function(e,t){var o,n,i,r,a,d,u,p,f,g,c,v=t.layoutId,m=e.appConfig.layouts;if(!m[v])return null;var y,h,I=m[v],w=t.layoutItemId,L=I.content[w],S=!1,T=!1,b=!1,C=!1,M=!1,P=!1,x=!1,B=!1;if(L&&L.widgetId){var N=e.appConfig.widgets[L.widgetId];y=N.style,S=!0===(null===(n=null===(o=N.manifest)||void 0===o?void 0:o.properties)||void 0===n?void 0:n.supportInlineEditing),C=!0===(null===(r=null===(i=N.manifest)||void 0===i?void 0:i.properties)||void 0===r?void 0:r.supportRepeat),x=!0===(null===(d=null===(a=N.manifest)||void 0===a?void 0:a.properties)||void 0===d?void 0:d.canCrossLayoutBoundary);var O=e.widgetsRuntimeInfo[L.widgetId];T=null!=(p=null===(u=O)||void 0===u?void 0:u.isClassLoaded)&&p,b=S&&(null===(f=O)||void 0===f?void 0:f.isInlineEditing),(B=(null===(c=null===(g=N.manifest)||void 0===g?void 0:g.extensions)||void 0===c?void 0:c.length)>0)&&(h=N),M=s(L.widgetId,e),P=l(L.widgetId,e)}return{hasEmbeddedLayout:P,supportInlineEditing:S,supportRepeat:C,isClassLoaded:T,isInlineEditing:b,widgetStyle:y,canCrossLayoutBoundary:x,hasExtension:B,widgetJson:h,widgetId:L.widgetId,isFunctionalWidget:M}},t.snapToGridSize=function(e,t){return Math.round(e/t)*t},t.removePositionRelatedStyle=function(e){return["height","width","order","flexGrow","flexShrink","alignSelf"].forEach((function(t){e[t]&&delete e[t]})),e},t.replaceBoundingBox=function(e,t,o){if(!e)return n.Immutable({left:i(t.left)?t.left:Math.round(t.left)+"px",top:i(t.top)?t.top:Math.round(t.top)+"px",width:i(t.width)?t.width:Math.round(t.width)+"px",height:i(t.height)?t.height:Math.round(t.height)+"px"});var r=e;return["left","right","top","bottom","width","height"].forEach((function(e){null!=r[e]?r=d(e,r,t[e],o):null!=t[e]&&(r=r.set(e,t[e]))})),r},t.updateBoundingBoxProp=d,t.relativeClientRect=function(e,t){return{left:e.left-t.left,top:e.top-t.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,id:null}},t.findContainerWidgetId=u,t.getBuilderThemeVariables=function(){var e=window.parent;if(e&&e.jimuConfig&&e.jimuConfig.isBuilder)return e._appState.theme},t.parseTranslateCoords=function(e){var t=0,o=0;if(e&&0===e.indexOf("translate(")){var n=e.substring("translate(".length).split(",");n.length>1&&(t=parseFloat(n[0]),o=parseFloat(n[1]))}return{x:t,y:o}},t.isWidgetHasEmbeddedLayout=l,t.isFunctionalWidget=s,t.isRTL=function(){var e,t;return null!=(t=null===(e=n.getAppStore().getState().appContext)||void 0===e?void 0:e.isRTL)&&t},t.parseAspectRatio=function(e){var t=100,o=100;if("number"==typeof e)t=100,o=Math.round(100*e);else if("string"==typeof e){var n=e.split(":");t=parseInt(n[0],10),o=parseInt(n[1],10)}return o/t},t.getWidgetHeight=p,t.getHeightOfLayoutItems=function(e,t,o){var n=u(e,o),i=p(e,t,n);if(i>0){var r=e.layouts[o].order||[],a={};return r.forEach((function(t){var n=e.layouts[o].content[t];a[t]=f(i,n)})),a}return null},t.calRowItemHeight=f},50:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0);t.LayoutContext=n.React.createContext({})},51:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={},i={};t.registerLayoutBuilder=function(e,t){n[e]=t},t.registerLayoutViewer=function(e,t){i[e]=t},t.findLayoutBuilder=function(e){return n[e]},t.findLayoutViewer=function(e){return i[e]}}})}));