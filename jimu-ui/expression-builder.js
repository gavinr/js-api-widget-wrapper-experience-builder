define(["jimu-core","jimu-core/react","jimu-ui","jimu-core/react-dom/server"],(function(e,t,n,r){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=712)}({0:function(t,n){t.exports=e},1:function(e,n){e.exports=t},149:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(3),s=n(150);t.getWhetherUseDssMatchExpDss=function(e,t){var n=r.DataSourceManager.getInstance();return!e||!e.dataSourceId||!!(t.some((function(t){return t===e.dataSourceId}))&&n&&n.getDataSource(e.dataSourceId))},t.getExpressionFromString=function(e,t){if(!e)return"";switch(e){case s.ExpressionInputFrom.Attribute:return t.formatMessage({id:"attribute",defaultMessage:o.defaultMessages.attribute});case s.ExpressionInputFrom.Statistics:return t.formatMessage({id:"statistics",defaultMessage:o.defaultMessages.statistics});case s.ExpressionInputFrom.Expression:return t.formatMessage({id:"expression",defaultMessage:o.defaultMessages.expression});case s.ExpressionInputFrom.Static:return t.formatMessage({id:"static",defaultMessage:o.defaultMessages.static});default:return""}}},150:function(e,t,n){"use strict";var r,o,s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Attribute="ATTRIBUTE",e.Statistics="STATISTICS",e.Expression="EXPRESSION"}(r=t.ExpressionFrom||(t.ExpressionFrom={})),function(e){e.Static="STATIC"}(o||(o={})),t.ExpressionInputFrom=s(s({},o),r)},151:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),i=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.render=function(){return s.React.createElement("span",{className:this.props.className,contentEditable:!!this.props.isEditable,suppressContentEditableWarning:!0,id:this.props.id,style:this.props.style,title:this.props.title||null,tabIndex:this.props.tabIndex||null},this.props.exp)},t}(s.React.PureComponent);t.default=i},196:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EXP_PART_PREFIX="part",t.EXP_CONTAINER_PREFIX="expression",function(e){e.Part="PART",e.Char="CHAR"}(t.ExpSelectionType||(t.ExpSelectionType={})),function(e){e.Field="FIELD",e.DataSource="DATASOURCE",e.Function="FUNCTION"}(t.PopoverType||(t.PopoverType={}))},2:function(e,t,n){e.exports=n(36)()},3:function(e,t){e.exports=n},320:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(196);function s(e){if(!e)return!1;var t=e.split("-");return!(!t.length||2!==t.length||t[0]!==o.EXP_CONTAINER_PREFIX||!/^\d+$/.test(t[1]))}function i(e,t){return t&&e?t.split(e+"-")[1]:null}function a(e,t){if(!t||!e)return!1;var n=i(e,t);return!(!n||n.split("-").length!==o.EXP_PART_PREFIX.split("-").length+1||t.indexOf(o.EXP_PART_PREFIX)!==e.length+1||!/\d$/.test(t))}function p(e){return!isNaN(e)&&"[object Number]"===Object.prototype.toString.call(e)}function c(e){return!(!e||'"'!==e)}function l(e){return!(!e||"{"!==e)}function u(e){return!!e&&/^[\+\-\*\/\,\(\)\s+]$/.test(e)}t.getNodeByPartId=function(e,t){return e?t?t.querySelector("#"+e):document&&document.querySelector("#"+e):null},t.getWhetherNodeIsParentOfParts=s,t.getPartIdByChildNode=function(e,t){if(!t||s(t.id))return null;for(;t&&!a(e,t.id);)t=t.parentElement;return t?t.id:null},t.getSortedKeys=function(e){return Object.keys(e).sort((function(e,t){return e.localeCompare(t)}))},t.getSortedArrayByLabel=function(e){return e.sort((function(e,t){return e.label.localeCompare(t.label)}))},t.getPartIdByIndex=function(e,t){return p(t)?e+"-"+o.EXP_PART_PREFIX+"-"+t:null},t.getIndexByPartId=function(e,t){if(!t)return null;var n=t.split("-"),r=a(e,t)?n.length-1:-1;return r>-1?parseInt(n[r]):null},t.getInernalId=i,t.getWhetherIsPartId=a,t.isPartUnmergeable=function(e){return!e||(e.type?e.type===r.ExpressionPartType.String||e.type===r.ExpressionPartType.Field||e.type===r.ExpressionPartType.Operator:(console.warn("Part has no type: ",e),!1))},t.isCharacterUnmergeable=function(e){return!!e&&(u(e)||c(e)||l(e))},t.isNumberVariable=p,t.getNewCharacterFromExpressionString=function(e,t){var n=e.split("");return t.split("").find((function(e,t){return e!==n[t]}))},t.triggerInputEvent=function(e){if(e){var t=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}},t.isCharDoubleQuotationMarker=c,t.isCharFrontCurlyBracket=l,t.isCharPostCurlyBracket=function(e){return!(!e||"}"!==e)},t.isField=function(e){return/^\{(.*?)\}$/.test(e)},t.isFunction=function(e){return!!e&&Object.keys(r.ExpressionFunctions).some((function(t){return r.ExpressionFunctions[t]===e}))},t.isString=function(e){return!!e&&/^\"(.*?)\"$/.test(e)},t.isNumber=function(e){return!!e&&(/^\d*\.?\d+(\d|\s)*$/.test(e)||/^\d+\.?\d*(\d|\s)*$/.test(e))},t.isOperator=u,t.isNeedDataSourceFunction=function(e){return e&&e===r.ExpressionFunctions.Count},t.getJimuFieldNameFromAlias=function(e,t){if(!e||!t)return null;var n=r.DataSourceManager.getInstance().getDataSource(e),o=n&&n.getSchema&&n.getSchema(),s=o&&o.fields;return s&&Object.keys(s).sort((function(e,t){return e.localeCompare(t)})).find((function(e){return(s[e].alias||s[e].name)===t}))||null},t.areFunctionParts=function(e){if(!e)return!1;var t=e[0]&&e[0].type===r.ExpressionPartType.Function,n=e[1]&&e[1].type===r.ExpressionPartType.Operator&&"("===e[1].exp,o=e[e.length-1]&&e[e.length-1].type===r.ExpressionPartType.Operator&&")"===e[e.length-1].exp;return t&&n&&o},t.getAddedPartIndexes=function(e){return e?Object.keys(e).filter((function(t){return e[t]&&e[t].part&&!e[t].isReplacing})).map((function(e){return parseInt(e)})):[]},t.getRemovedPartIndexes=function(e){return e?Object.keys(e).filter((function(t){return e[t]&&!e[t].part&&e[t].isReplacing})).map((function(e){return parseInt(e)})):[]}},321:function(e,t){e.exports='<svg viewBox="0 0 12 14" xmlns="http://www.w3.org/2000/svg"><path d="M2 1.667V13a.667.667 0 01-1.333 0V1c0-.368.298-.667.666-.667H8c.177 0 .346.07.471.196l2.667 2.666a.667.667 0 01.195.472V13a.667.667 0 01-.666.667H4a.667.667 0 010-1.334h6v-8.39L7.724 1.667H2zm2 6a.667.667 0 110-1.334h4a.667.667 0 010 1.334H4zM4 5a.667.667 0 110-1.333h1.333a.667.667 0 010 1.333H4zm0 5.333A.667.667 0 014 9h2.667a.667.667 0 010 1.333H4z" fill="#FFF" fill-rule="nonzero"></path></svg>'},322:function(e,t){e.exports='<svg viewBox="0 0 12 14" xmlns="http://www.w3.org/2000/svg"><path d="M10.056 3.165V2.063H2.892l4.215 4.534A.732.732 0 017.1 7.602L2.93 11.937h7.125v-.666a.732.732 0 011.463 0v1.397a.733.733 0 01-.732.732H1.213a.73.73 0 01-.528-1.239l4.88-5.074L.677 1.83A.732.732 0 011.213.6h9.574c.404 0 .732.328.732.732v1.833a.733.733 0 01-1.463 0z" fill="#FFF" fill-rule="nonzero"></path></svg>'},323:function(e,t){e.exports='<svg viewBox="0 0 16 12" xmlns="http://www.w3.org/2000/svg"><path d="M2 6l4-4H4L0 6l4 4h2L2 6zm10-4h-2l4 4-4 4h2l4-4-4-4zM8.5 0L6 12h1.5L10 0H8.5z" fill="#FFF" fill-rule="nonzero"></path></svg>'},324:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M3.333 0C2.597 0 2 .597 2 1.333V4c0 .736-.597 1.333-1.333 1.333H0v1.334h.667A1.333 1.333 0 012 8v2.667C2 11.403 2.597 12 3.333 12h1.334v-1.333H3.333V7.333C3.333 6.597 2.736 6 2 6c.736 0 1.333-.597 1.333-1.333V1.333h1.334V0m4 0C9.403 0 10 .597 10 1.333V4a1.333 1.333 0 001.333 1.333H12v1.334h-.667A1.333 1.333 0 0010 8v2.667C10 11.403 9.403 12 8.667 12H7.333v-1.333h1.334V7.333C8.667 6.597 9.264 6 10 6a1.333 1.333 0 01-1.333-1.333V1.333H7.333V0h1.334z" fill="#FFF" fill-rule="nonzero"></path></svg>'},34:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 6.598L14.308.29a.991.991 0 011.402 1.402L9.402 8l6.308 6.308a.991.991 0 01-1.402 1.402L8 9.402 1.692 15.71A.991.991 0 01.29 14.308L6.598 8 .29 1.692A.991.991 0 011.692.29L8 6.598z" fill="#000" fill-rule="nonzero"></path></svg>'},36:function(e,t,n){"use strict";var r=n(37);function o(){}function s(){}s.resetWarningCache=o,e.exports=function(){function e(e,t,n,o,s,i){if(i!==r){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:s,resetWarningCache:o};return n.PropTypes=n,n}},37:function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},426:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),i=n(3),a=n(149),p=n(718),c=n(719),l=n(196),u=n(721),d=n(722),f=n(723),h=n(724),x=n(725),g=n(726),m=n(727),y=n(728),v=n(427),b=function(e){function t(n){var r=e.call(this,n)||this;return r.expressionString="",r.ltrStyle={direction:"ltr"},r.setSelectionToEnd=function(){r.setState({isPopoverOpen:!1,expSelection:{partId:r.props.expression&&r.props.expression.parts&&v.getPartIdByIndex(r.id,r.props.expression.parts.length-1)||v.getPartIdByIndex(r.id,0),type:l.ExpSelectionType.Part,toStart:!1}})},r.getWhetherLoseFocus=function(){var e=window.getSelection&&window.getSelection();return!(e&&r.contentEditableContainer&&r.contentEditableContainer.current.contains(e.focusNode)&&r.contentEditableContainer.current!==e.focusNode)},r.getExpressionString=function(e){var t=e||r.contentEditableContainer?r.contentEditableContainer.current:document,n=t&&t.querySelector("#"+r.id);return n?n.textContent.replace(/\ufeff/g,""):""},r.getComponent=function(e,t){var n=v.getPartIdByIndex(r.id,t),o=r.getWhetherInEditablePart();switch(e.type){case s.ExpressionPartType.Field:return s.jsx(u.default,{exp:e.exp,id:n,key:t,isDsDisabled:!a.getWhetherUseDssMatchExpDss(e,r.props.dataSourceIds.asMutable()),isEditable:o&&r.state.expSelection.partId===n,dataSourceId:e.dataSourceId,isError:!s.expressionUtils.getWhetherFieldInDs(e.dataSourceId,e.jimuFieldName,e.exp.replace(/^\{/,"").replace(/\}$/,""))});case s.ExpressionPartType.String:return s.jsx(d.default,{exp:e.exp,id:n,key:t,isEditable:o&&r.state.expSelection.partId===n});case s.ExpressionPartType.Operator:return s.jsx(g.default,{exp:e.exp,id:n,key:t,isEditable:o&&r.state.expSelection.partId===n});case s.ExpressionPartType.Function:return s.jsx(f.default,{exp:e.exp,id:n,key:t,isDsDisabled:!a.getWhetherUseDssMatchExpDss(e,r.props.dataSourceIds.asMutable()),isEditable:o&&r.state.expSelection.partId===n,externalId:r.id,dataSourceIds:r.props.dataSourceIds});case s.ExpressionPartType.Number:return s.jsx(h.default,{exp:e.exp,id:n,key:t,isEditable:o&&r.state.expSelection.partId===n});case s.ExpressionPartType.Unknown:return s.jsx(x.default,{exp:e.exp,id:n,key:t,isEditable:o&&r.state.expSelection.partId===n});default:return null}},r.getWhetherInEditablePart=function(){return!(!r.state.expSelection||r.state.expSelection.type!==l.ExpSelectionType.Char)},r.getSingleExpFromPopoverItem=function(e){switch(e.type){case l.PopoverType.Field:return"{"+e.content+"}";default:return e.content}},r.renderPartsToHtml=function(e){return p.renderToStaticMarkup(s.jsx("p",{id:r.id,className:"w-100 m-0 p-1",spellCheck:!1,style:{textAlign:"left"}},"\ufeff",e&&e.map((function(e,t){return r.getComponent(e,t)})),"\ufeff"))},r.getNewExpression=function(e){return{parts:e,name:r.props.expression&&r.props.expression.name||r.id}},r.onChange=function(e){var t=e.currentTarget.querySelector("#"+r.id);if(t&&e.isTrusted){var n=r.getExpressionString(t),o=v.getNewCharacterFromExpressionString(r.expressionString,n);if(o){var s=r.getWhetherInEditablePart(),i=r.props.expression&&r.props.expression.parts,a=s?v.getSelectionRange():null,p=v.getNextNodeOfSelection(r.id),c=v.addCharactersToParts(r.id,i,o,s,r.props.dataSourceIds.asMutable(),a,p),l=v.applyEditResultToParts(c,i),u=s?v.getSelectionPosInnerPart(r.id,document&&document.querySelector("#"+r.id)):null,d=v.getExpSelectionAndEitablePart(r.id,s,c,l,u);r.setState({isPopoverOpen:!1,expSelection:d},(function(){r.setState({isPopoverOpen:!0})})),r.props.onChange(r.getNewExpression(l))}}},r.onClick=function(e){var t=v.getPartIdByChildNode(r.id,e.target),n=v.getIndexByPartId(r.id,t);if(!v.isNumberVariable(n)||n<0)(e.target===r.contentEditableContainer.current||r.contentEditableContainer.current.contains(e.target))&&r.setSelectionToEnd();else{var o=n>-1?v.getNodeByPartId(t,r.contentEditableContainer.current):null;if(o&&r.state.expSelection&&(r.state.expSelection.type!==l.ExpSelectionType.Char||v.getIndexByPartId(r.id,r.state.expSelection.partId)!==n)&&r.props.expression&&r.props.expression.parts&&r.props.expression.parts[n]){var s={partId:t,type:l.ExpSelectionType.Char,startOffset:o.textContent.length};r.setState({expSelection:s,isPopoverOpen:!1},(function(){return r.setState({isPopoverOpen:v.getWhetherPartNeedPopover(r.props.expression.parts[n].type)})}))}}},r.onHelperItemSelect=function(e,t){if(r.props.onChange(e),e&&e.parts&&t){var n,o=v.getIndexByPartId(r.id,t),i=e.parts[o];if(!i)return void console.warn("Can not move selection because can not find part: ",t);var a=void 0;if(i.type===s.ExpressionPartType.Operator)n=!1,a={type:l.ExpSelectionType.Part,partId:t,toStart:!1};else if(i.type===s.ExpressionPartType.Function){var p=v.isNeedDataSourceFunction(i.exp),c=i.dataSourceId;n=!1,a={type:l.ExpSelectionType.Part,partId:v.getPartIdByIndex(r.id,v.getIndexByPartId(r.id,t)+1),toStart:!1},p&&(c?a.partId=v.getPartIdByIndex(r.id,v.getIndexByPartId(r.id,t)+2):n=!0)}else n=!1,a={type:l.ExpSelectionType.Char,partId:t,startOffset:i.exp.length};r.setState({expSelection:a,isPopoverOpen:!1},(function(){return r.setState({isPopoverOpen:n})}))}},r.onBlur=function(e){r.props.onChange(r.props.expression)},r.onKeyDown=function(e){if(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),8===e.keyCode||46===e.keyCode||39===e.keyCode||37===e.keyCode||13===e.keyCode||40===e.keyCode||38===e.keyCode)e.preventDefault(),8!==e.keyCode&&46!==e.keyCode||v.triggerInputEvent(e.currentTarget),8===e.keyCode?r.handleBackspace():46===e.keyCode?r.handleDelete():37===e.keyCode?r.handleLeftArrow():39===e.keyCode?r.handleRightArrow():13===e.keyCode?r.handleEnter():40===e.keyCode?r.handleDownArrow():38===e.keyCode&&r.handleUpArrow();else if(e.keyCode>=48&&e.keyCode<=57||e.keyCode>=65&&e.keyCode<=90){v.getSelectionRange().collapsed||r.handleBackspace()}},r.handleBackspace=function(){var e,t,n=r.props.expression&&r.props.expression.parts;if(r.getWhetherInEditablePart()){var o=v.getSelectionPosInnerPart(r.id,r.contentEditableContainer.current);if(o&&o.partId){var s=o.startOffset===o.endOffset?o.startOffset-1:o.startOffset,i=o.endOffset-1;e=v.removeCharactersFromOnePart(r.id,n,o.partId,s,i),t=i-s+1}}else{var a=v.getStartPartIndexOfRangeSelection(r.id),p=v.getEndPartIndexOfRangeSelection(r.id,n);e=v.removeParts(r.id,n,a,p),t=0}r.doRemove(e,n,t)},r.handleDelete=function(){var e,t,n=r.props.expression&&r.props.expression.parts;if(r.getWhetherInEditablePart()){var o=v.getSelectionPosInnerPart(r.id,r.contentEditableContainer.current);if(o&&o.partId){var s=o.startOffset,i=o.startOffset===o.endOffset?o.endOffset:o.endOffset-1;e=v.removeCharactersFromOnePart(r.id,n,o.partId,s,i),t=s===i?0:i-s+1}}else{var a=v.getStartPartIndexOfRangeSelection(r.id),p=v.getEndPartIndexOfRangeSelection(r.id,n),c=v.getSelectionRange(),l=c.collapsed?v.isNumberVariable(a)?a+1:0:a,u=c.collapsed?v.isNumberVariable(a)?a+1:0:p;e=v.removeParts(r.id,n,l,u),t=0}r.doRemove(e,n,t)},r.doRemove=function(e,t,n){var o=v.applyEditResultToParts(e,t),s=r.getWhetherInEditablePart(),i=s?v.getSelectionPosInnerPart(r.id,document&&document.querySelector("#"+r.id)):null,a=e?v.getExpSelectionAndEitablePart(r.id,s,e,o,i,n):r.state.expSelection;r.props.onChange(r.getNewExpression(o)),r.setState({isPopoverOpen:!1,expSelection:a},(function(){return r.setState({isPopoverOpen:a.partId&&o[v.getIndexByPartId(r.id,a.partId)]&&v.getWhetherPartNeedPopover(o[v.getIndexByPartId(r.id,a.partId)].type)})}))},r.handleLeftArrow=function(){if(r.getWhetherInEditablePart()){var e=v.getSelectionPosInnerPart(r.id,r.contentEditableContainer.current);if(e&&e.partId){var t=e.startOffset-1>-1?{type:l.ExpSelectionType.Char,partId:e.partId,startOffset:e.startOffset-1}:v.getSiblingOfExpSelection(r.id,e.partId,!0,!1,r.props.expression&&r.props.expression.parts);r.setState({expSelection:t,isPopoverOpen:!1})}}else{var n=v.getPreviousNodeOfSelection(r.id);n&&r.setState({expSelection:{partId:n.id,toStart:!0,type:l.ExpSelectionType.Part},isPopoverOpen:!1})}},r.handleRightArrow=function(){if(r.getWhetherInEditablePart()){var e=v.getSelectionPosInnerPart(r.id,r.contentEditableContainer.current);if(e&&e.partId){var t=e.startOffset+1<=e.contentLength?{type:l.ExpSelectionType.Char,partId:e.partId,startOffset:e.startOffset+1}:v.getSiblingOfExpSelection(r.id,e.partId,!1,!1,r.props.expression&&r.props.expression.parts);r.setState({expSelection:t,isPopoverOpen:!1})}}else{var n=v.getNextNodeOfSelection(r.id);n&&r.setState({expSelection:{partId:n.id,toStart:!1,type:l.ExpSelectionType.Part},isPopoverOpen:!1})}},r.handleDownArrow=function(){if(r.state.isPopoverOpen){var e=v.getPopoverTarget(r.id,r.getWhetherInEditablePart(),r.props.expression&&r.props.expression.parts),t=v.getPopoverItems(r.id,e,r.props.expression&&r.props.expression.parts,r.props.dataSourceIds.asMutable()),n=r.state.selectedPopoverItemIndex;n=n?parseInt(n)<t.length-1?""+(parseInt(r.state.selectedPopoverItemIndex)+1):""+(t.length-1):"0",r.setState({selectedPopoverItemIndex:n})}},r.handleUpArrow=function(){if(r.state.isPopoverOpen){var e=v.getPopoverTarget(r.id,r.getWhetherInEditablePart(),r.props.expression&&r.props.expression.parts),t=v.getPopoverItems(r.id,e,r.props.expression&&r.props.expression.parts,r.props.dataSourceIds.asMutable()),n=r.state.selectedPopoverItemIndex;n=n?parseInt(n)>0?""+(parseInt(r.state.selectedPopoverItemIndex)-1):"0":""+(t.length-1),r.setState({selectedPopoverItemIndex:n})}},r.handleEnter=function(){if(r.state.isPopoverOpen&&r.state.selectedPopoverItemIndex){var e=v.getPopoverTarget(r.id,r.getWhetherInEditablePart(),r.props.expression&&r.props.expression.parts),t=v.getPopoverItems(r.id,e,r.props.expression&&r.props.expression.parts,r.props.dataSourceIds.asMutable());r.setState({selectedPopoverItemIndex:null}),r.handlePopoverItemClick(t[r.state.selectedPopoverItemIndex],e)}else{var n=r.props.expression&&r.props.expression.parts&&r.props.expression.parts.length||0;r.setState({isPopoverOpen:!1,expSelection:{partId:r.state.expSelection&&r.state.expSelection.type===l.ExpSelectionType.Char?r.state.expSelection.partId:n>0?v.getPartIdByIndex(r.id,n-1):v.getPartIdByIndex(r.id,0),toStart:!1,type:l.ExpSelectionType.Part}})}},r.handlePopoverItemClick=function(e,t){if(e&&t){var n=r.props.expression&&r.props.expression.parts?r.props.expression.parts.slice():[];e.type===l.PopoverType.Field?r.handleFieldPopoverClick(n,t,e):e.type===l.PopoverType.DataSource?r.handleDsPopoverClick(n,t,e):e.type===l.PopoverType.Function&&r.handleFunctionPopoverClick(n,t,e)}},r.handleFieldPopoverClick=function(e,t,n){void 0===e&&(e=[]);var o=v.getIndexByPartId(r.id,t),s=r.props.dataSourceIds&&r.props.dataSourceIds.length>1?e[o].dataSourceId:r.props.dataSourceIds&&r.props.dataSourceIds[0],i=v.getExpressionPart(r.getSingleExpFromPopoverItem(n),s,n.id);e.splice(o,1,i);var a={partId:v.getPartIdByIndex(r.id,o),toStart:!1,type:l.ExpSelectionType.Part};r.setState({isPopoverOpen:!1,expSelection:a}),r.props.onChange(r.getNewExpression(e))},r.handleDsPopoverClick=function(e,t,n){void 0===e&&(e=[]);var o,i=v.getIndexByPartId(r.id,t),a=e.slice();if(a[i].dataSourceId=n.id,a[i].type===s.ExpressionPartType.Function&&v.isNeedDataSourceFunction(a[i].exp)){var p=i+2;o={partId:v.getPartIdByIndex(r.id,p),type:l.ExpSelectionType.Part,toStart:!1},(i+2>=a.length||"("!==a[i+1].exp||")"!==a[i+2].exp)&&(a=a.slice(0,i+1).concat([{type:s.ExpressionPartType.Operator,exp:"("},{type:s.ExpressionPartType.Operator,exp:")"}]).concat(a.slice(i+1)))}else o={partId:t,type:l.ExpSelectionType.Char,startOffset:a[i].exp.length};r.props.onChange(r.getNewExpression(a)),r.setState({isPopoverOpen:!1,expSelection:o},(function(){return r.setState({isPopoverOpen:!(a[i].type===s.ExpressionPartType.Function&&a[i].exp===s.ExpressionFunctions.Count)})}))},r.handleFunctionPopoverClick=function(e,t,n){void 0===e&&(e=[]);var o=v.getIndexByPartId(r.id,t),i=v.getExpressionPart(r.getSingleExpFromPopoverItem(n)),a={partId:v.getPartIdByIndex(r.id,o+1),type:l.ExpSelectionType.Part,toStart:!1};r.props.dataSourceIds&&1===r.props.dataSourceIds.length&&v.isNeedDataSourceFunction(i.exp)&&(i.dataSourceId=r.props.dataSourceIds[0],a={partId:v.getPartIdByIndex(r.id,o+2),type:l.ExpSelectionType.Part,toStart:!1}),e.splice(o,1,i,{type:s.ExpressionPartType.Operator,exp:"("},{type:s.ExpressionPartType.Operator,exp:")"}),r.props.onChange(r.getNewExpression(e)),r.setState({isPopoverOpen:r.props.dataSourceIds&&r.props.dataSourceIds.length>1&&i.type===s.ExpressionPartType.Function&&i.exp===s.ExpressionFunctions.Count,expSelection:a})},t.count++,r.id=l.EXP_CONTAINER_PREFIX+"-"+t.count,r.contentEditableContainer=s.React.createRef(),r.state={isPopoverOpen:!1,isEditorMounted:!1,expSelection:null,selectedPopoverItemIndex:null},r}return o(t,e),t.prototype.componentDidMount=function(){this.expressionString=this.getExpressionString()||"",this.props.autoFocus&&(this.props.expression&&this.props.expression.parts&&1===this.props.expression.parts.length&&this.props.expression.parts[0].type===s.ExpressionPartType.String?this.setState({expSelection:{partId:v.getPartIdByIndex(this.id,0),type:l.ExpSelectionType.Char,startOffset:this.props.expression.parts[0].exp.length-1}}):(this.contentEditableContainer.current.focus(),this.setSelectionToEnd())),this.setState({isEditorMounted:!0}),this.contentEditableContainer.current.ondragstart=function(){return!1},this.contentEditableContainer.current.onpaste=function(){return!1}},t.prototype.componentDidUpdate=function(e,t){this.state.expSelection&&this.state.expSelection.partId&&(t.expSelection!==this.state.expSelection||this.props.autoFocus&&this.getWhetherLoseFocus())&&(this.state.expSelection.type===l.ExpSelectionType.Part?v.moveSelectionByPart(this.state.expSelection.partId,this.state.expSelection.toStart,this.contentEditableContainer.current):this.state.expSelection.type===l.ExpSelectionType.Char&&v.moveSelectionByCharacter(this.state.expSelection.partId,this.state.expSelection.startOffset,this.contentEditableContainer.current)),e.expression!==this.props.expression&&(this.props.expression&&this.props.expression.parts?this.expressionString=this.getExpressionString():this.expressionString="")},t.prototype.render=function(){var e,t;this.state.isPopoverOpen&&(t=v.getPopoverTarget(this.id,this.getWhetherInEditablePart(),this.props.expression&&this.props.expression.parts));var n=this.renderPartsToHtml(this.props.expression&&this.props.expression.parts);n=n&&n.replace(/&quot;/g,'"');var r=s.expressionUtils.getWhetherExpressionValid(this.props.expression);return s.jsx(s.MultipleDataSourceComponent,{useDataSources:this.props.dataSourceIds&&s.Immutable(this.props.dataSourceIds.map((function(e){return{dataSourceId:e}})))},s.jsx("div",{style:this.props.style,onClick:this.onClick,className:s.classNames("w-100 h-100",(e={},e[this.props.className]=!!this.props.className,e))},s.jsx("div",{className:"w-100 h-100 component-expression-editor"},s.jsx("div",{className:s.classNames("w-100 expression-editor-input",{"error-border":!r})},s.jsx(c.default,{innerRef:this.contentEditableContainer,html:n,disabled:!(!this.state.expSelection||this.state.expSelection.type!==l.ExpSelectionType.Char),onChange:this.onChange,onKeyDown:this.onKeyDown,onBlur:this.onBlur,className:"w-100 break-all expression-editor-input-content-editable",style:this.ltrStyle}),this.state.isPopoverOpen&&s.jsx(m.default,{targetNodeId:t,items:v.getPopoverItems(this.id,t,this.props.expression&&this.props.expression.parts,this.props.dataSourceIds.asMutable()),onClick:this.handlePopoverItemClick,theme:this.props.theme,selectedItemIndex:this.state.selectedPopoverItemIndex})),s.jsx("div",{className:"mt-2 error-message"},!r&&this.props.intl.formatMessage({id:"invalidExpression",defaultMessage:i.defaultMessages.invalidExpression})),s.jsx("div",{className:"expression-editor-helper"},s.jsx(y.default,{expression:this.props.expression,dataSourceIds:this.props.dataSourceIds,onSelect:this.onHelperItemSelect,intl:this.props.intl,externalId:this.id,inEditablePart:this.getWhetherInEditablePart(),container:this.state.isEditorMounted?this.contentEditableContainer.current:null,expSelection:this.state.expSelection})))))},t.count=-1,t}(s.React.PureComponent),I=s.themeUtils.withStyles(s.injectIntl(b),"ExpressionEditor");t.default=I},427:function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(320)),r(n(428)),r(n(729))},428:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(320),s=n(196);function i(e,t){if(e&&e.collapsed&&t){var n,r=e;return!!(r.compareBoundaryPoints&&document&&document.createRange)&&((n=document.createRange()).selectNodeContents(t),n.collapse(!0),r.compareBoundaryPoints(r.START_TO_END,n)<1)}}function a(e,t){if(e&&e.collapsed&&t){var n,r=e;return!!(r.compareBoundaryPoints&&document&&document.createRange)&&((n=document.createRange()).selectNodeContents(t),n.collapse(!1),r.compareBoundaryPoints(r.START_TO_END,n)>-1)}}function p(e,t,n){if(!document||!document.createRange)return null;if(n||((n=document.createRange()).selectNodeContents(e),n.setStart(e,0)),0===t.count)n.setEnd(e,t.count);else if(e&&t.count>0)if(e.nodeType===Node.TEXT_NODE)e.textContent.length<t.count?t.count-=e.textContent.length:(n.setEnd(e,t.count),t.count=0);else for(var r=0;r<e.childNodes.length&&(n=p(e.childNodes[r],t,n),0!==t.count);r++);return n}function c(){var e=null;if(window.getSelection&&window.getSelection().getRangeAt){var t=window.getSelection();t.rangeCount>0&&(e=t.getRangeAt(0))}return e}function l(e){var t,n,r=document&&document.querySelector("#"+e),s=c();if(r&&s)for(t=r.lastElementChild;t;){if(a(s,t)&&o.getWhetherIsPartId(e,t.id)){n=t;break}t=t.previousElementSibling}return n}function u(e,t,n){var r=d(e,n),i=o.isNumberVariable(r),a=i?r:t.length-1,p=i?n[r].startOffset:0;return{partId:o.getPartIdByIndex(e,a),type:s.ExpSelectionType.Char,startOffset:p}}function d(e,t){var n=Object.keys(t).find((function(e){return t[e].part&&o.isNumberVariable(t[e].startOffset)}));return parseInt(n)}t.getWhetherNodeAfterRange=i,t.getWhetherNodeBeforeRange=a,t.moveSelectionByPart=function(e,t,n){var r=o.getNodeByPartId(e,n);if(r){if(window.getSelection&&document&&document.createRange){var s=document.createRange();r&&(s.selectNode(r),s.collapse(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(s))}}else n&&n.focus()},t.moveSelectionByCharacter=function(e,t,n){var r=o.getNodeByPartId(e,n);if(r&&t>=0&&window.getSelection){var s=p(r,{count:t});s&&(s.collapse(!1),window.getSelection().removeAllRanges(),window.getSelection().addRange(s))}},t.createRange=p,t.getSelectionRange=c,t.getSelectionPosInnerPart=function(e,t){var n=c();if(!n)return console.warn("Can not get range"),null;var r=null,s=n.startContainer.nodeType===Node.TEXT_NODE?n.startContainer.parentElement:n.startContainer,i=s===(n.endContainer.nodeType===Node.TEXT_NODE?n.endContainer.parentElement:n.endContainer)&&s&&o.getWhetherIsPartId(e,s.id),a=i?s:null,p=i?s.id:null;return a&&p?r={partId:p,startOffset:n.startOffset,endOffset:n.endOffset,contentLength:a.textContent.length||0}:console.warn("Can not match selection to part"),r},t.getPartIdOfSelection=function(e){var t=c();if(t&&t.collapsed&&t.startContainer){var n=t.startContainer;return o.getPartIdByChildNode(e,n)}return null},t.getPreviousNodeOfSelection=l,t.getNextNodeOfSelection=function(e){var t,n,r=document&&document.querySelector("#"+e),s=c();if(r&&s)for(t=r.firstElementChild;t;){if(i(s,t)&&o.getWhetherIsPartId(e,t.id)){n=t;break}t=t.nextElementSibling}return n},t.getSiblingOfExpSelection=function(e,t,n,r,i){var a=o.getNodeByPartId(t,document&&document.querySelector("#"+e)),p=null;return a?(!n&&a.nextElementSibling&&o.getWhetherIsPartId(e,a.nextElementSibling.id)?p=a.nextElementSibling.id:n&&a.previousElementSibling&&o.getWhetherIsPartId(e,a.previousElementSibling.id)&&(p=a.previousElementSibling.id),p?{type:s.ExpSelectionType.Char,partId:p,startOffset:n?o.getNodeByPartId(p,document&&document.querySelector("#"+e)).textContent.length:0}:{partId:n?o.getPartIdByIndex(e,0):o.getPartIdByIndex(e,i&&i.length>0?i.length-1:0),toStart:n,type:s.ExpSelectionType.Part}):null},t.getStartPartIndexOfRangeSelection=function(e){var t,n=c();if(n.collapsed){var r=l(e);t=r&&r.id&&o.getWhetherIsPartId(e,r.id)&&o.getIndexByPartId(e,r.id)}else n.startContainer.nodeType===Node.TEXT_NODE&&/^\ufeff$/.test(n.startContainer.textContent)?t=0:n.startContainer.id===e?t=n.startOffset-1:o.getWhetherIsPartId(e,n.startContainer.id)?t=o.getIndexByPartId(e,n.startContainer.id)+n.startOffset+1:console.warn("Can not get start part of selection");return o.isNumberVariable(t)?t:null},t.getEndPartIndexOfRangeSelection=function(e,t){void 0===t&&(t=[]);var n,r=c();if(r.collapsed){var s=l(e);n=s&&s.id&&o.getWhetherIsPartId(e,s.id)&&o.getIndexByPartId(e,s.id)}else r.endContainer.nodeType===Node.TEXT_NODE&&/^\ufeff$/.test(r.endContainer.textContent)?n=t.length-1>-1?t.length-1:0:r.endContainer.id===e?n=r.endOffset-2:o.getWhetherIsPartId(e,r.endContainer.id)?n=o.getIndexByPartId(e,r.endContainer.id)-r.endOffset-1:console.warn("Can not get end part of selection");return o.isNumberVariable(n)?n:null},t.getExpSelectionAndEitablePart=function(e,t,n,i,a,p){var c=null;if(!n)return c;var l=Object.keys(n).find((function(e){return n[e]&&n[e].part&&(n[e].part.type===r.ExpressionPartType.String&&'""'===n[e].part.exp||n[e].part.type===r.ExpressionPartType.Field&&"{}"===n[e].part.exp)}));if(l&&n[l]&&n[l].part)c={partId:o.getPartIdByIndex(e,parseInt(l)),type:s.ExpSelectionType.Char,startOffset:1};else{var f=o.getAddedPartIndexes(n),h=o.getRemovedPartIndexes(n),x=f.length>0;if(h.length>0){var g=Math.min.apply(null,h)-1,m=i[g];if(t)if(m)c=h.length===Object.keys(n).length?{partId:o.getPartIdByIndex(e,g),type:s.ExpSelectionType.Char,startOffset:m.type===r.ExpressionPartType.String||m.type===r.ExpressionPartType.Field?m.exp.length-1:m.exp.length}:u(e,i,n);else{var y=g>-1?g:0;c={partId:o.getPartIdByIndex(e,y),type:s.ExpSelectionType.Part,toStart:!0}}else if(h.length===Object.keys(n).length){y=g>-1?g:0;var v=!(g>-1);c={partId:o.getPartIdByIndex(e,y),type:s.ExpSelectionType.Part,toStart:v}}else c=u(e,i,n)}else if(x)if(f.length===Object.keys(n).length){var b=Math.max.apply(null,f),I=o.getPartIdByIndex(e,b),E=n[b]&&n[b].part;c={partId:I,type:s.ExpSelectionType.Char,startOffset:E&&E.exp&&E.exp.length}}else c=u(e,i,n);else{var S=d(e,n),P=o.isNumberVariable(S)?S:parseInt(Object.keys(n)[0]),O=o.isNumberVariable(P)&&o.getPartIdByIndex(e,P);if(t){var _=a&&a.partId,F=O===_,C=a.endOffset-(o.isNumberVariable(p)?p:0),N=i[o.getIndexByPartId(e,_)],w=N&&N.exp?N.exp.length:-1;c={partId:O,type:s.ExpSelectionType.Char,startOffset:F&&C>=0&&C<=w?C:n[P]&&o.isNumberVariable(n[P].startOffset)?n[P].startOffset:0}}else c={partId:O,type:s.ExpSelectionType.Char,startOffset:n[P].startOffset}}}return c}},429:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(3),p=n(730),c=n(731),l=n(732),u=n(150),d=function(e){function t(t){var n,r=e.call(this,t)||this;return r.expressionFrom=((n={})[u.ExpressionFrom.Attribute]=r.props.intl.formatMessage({id:"attribute",defaultMessage:a.defaultMessages.attribute}),n[u.ExpressionFrom.Statistics]=r.props.intl.formatMessage({id:"statistics",defaultMessage:a.defaultMessages.statistics}),n[u.ExpressionFrom.Expression]=r.props.intl.formatMessage({id:"expression",defaultMessage:a.defaultMessages.expression}),n),r.onChange=function(e){r.props.onChange&&r.props.onChange(e)},r.getActiveExpressionFrom=function(){if(!r.props.expression||!r.props.expression.parts||0===r.props.expression.parts.length)return r.props.from[0];var e=i.groupExpressionPartsByFunction(r.props.expression.parts);return 1===e.length&&e[0].type===i.ExpressionPartType.Field?r.props.from.some((function(e){return e===u.ExpressionFrom.Attribute}))?u.ExpressionFrom.Attribute:r.props.from.some((function(e){return e===u.ExpressionFrom.Expression}))?u.ExpressionFrom.Expression:r.props.from[0]:1===e.length&&e[0].type===i.ExpressionPartType.Function&&r.props.from.some((function(e){return e===u.ExpressionFrom.Statistics}))?u.ExpressionFrom.Statistics:r.props.from.some((function(e){return e===u.ExpressionFrom.Expression}))?u.ExpressionFrom.Expression:r.props.from[0]},r.getTab=function(e,t,n){switch(e){case u.ExpressionFrom.Attribute:return i.jsx(p.default,{types:r.props.attributeTypes,dataSourceIds:t,expression:n,onChange:r.onChange});case u.ExpressionFrom.Statistics:return i.jsx(l.default,{dataSourceIds:t,expression:n,onChange:r.onChange,intl:r.props.intl});case u.ExpressionFrom.Expression:return i.jsx(c.default,s({},r.props,{dataSourceIds:t,expression:n,onChange:r.onChange,intl:r.props.intl}));default:return null}},r.onActiveTabChange=function(e){r.setState({active:e})},r.state={active:r.props.active||r.getActiveExpressionFrom()},r}return o(t,e),t.prototype.componentDidUpdate=function(e,t){this.props.from===e.from&&this.props.active===e.active&&this.props.expression===e.expression||this.setState({active:this.props.active||this.getActiveExpressionFrom()})},t.prototype.render=function(){var e,t=this;return i.jsx(i.MultipleDataSourceComponent,{useDataSources:this.props.dataSourceIds&&i.Immutable(this.props.dataSourceIds.map((function(e){return{dataSourceId:e}})))},i.jsx("div",{style:this.props.style,className:i.classNames("w-100 h-100",(e={},e[this.props.className]=!!this.props.className,e))},i.jsx("div",{className:"w-100 h-100 component-expression-builder"},this.props.from&&this.props.from.length>1?i.jsx(a.Nav,{fill:!0,underline:!0},this.props.from.map((function(e,n){return i.jsx(a.NavItem,{key:n,className:"w-33"},i.jsx(a.NavLink,{className:"text-truncate",title:t.expressionFrom[e],onClick:function(){t.onActiveTabChange(e)},active:t.state.active===e},t.expressionFrom[e]))}))):null,this.getTab(this.state.active,this.props.dataSourceIds,this.props.expression))))},t}(i.React.PureComponent),f=i.themeUtils.withStyles(i.injectIntl(d),"ExpressionBuilder");t.default=f},430:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(3),p=n(429),c=n(149),l=n(34),u=function(e){function t(t){var n,r,o,s,i,a=e.call(this,t)||this;return a.cursorStyle={cursor:"pointer"},a.fontSizeStyle={fontSize:"16px",fontWeight:500,color:null===(i=null===(s=null===(o=null===(r=null===(n=a)||void 0===n?void 0:n.props)||void 0===r?void 0:r.theme)||void 0===o?void 0:o.colors)||void 0===s?void 0:s.palette)||void 0===i?void 0:i.dark[600]},a.titleStyle={height:"51px",borderBottom:"0"},a.overflowYStyle={overflowY:"auto",height:"calc(100% - 30px)"},a.__unmount=!1,a.state={isExpBuilderShown:!1,isDataSourceInited:!1,SidePopper:null},a}return o(t,e),t.prototype.componentDidMount=function(){var e=this;this.__unmount=!1,i.moduleLoader.loadModule("jimu-ui/setting-components").then((function(t){return!e.__unmount&&e.setState({SidePopper:t.SidePopper})}))},t.prototype.componentWillUnmount=function(){this.__unmount=!0},t.prototype.render=function(){var e=this,t=this.state.SidePopper,n=this.props.from,r=n?n.length>1?this.props.intl.formatMessage({id:"dynamicContent",defaultMessage:a.defaultMessages.dynamicContent}):c.getExpressionFromString(n[0],this.props.intl):"";return i.jsx("div",{className:"w-100 h-100"},t&&i.jsx(t,{isOpen:this.props.isOpen&&!i.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right"},i.jsx("div",{className:"h-100 bg-light-300 border-color-gray-400 component-expression-builder-popup"},i.jsx("div",{className:"w-100 h-100 expression-popup"},i.jsx("div",{className:"jimu-widget-setting--header d-flex",style:this.titleStyle},i.jsx("div",{className:"m-0 text-truncate flex-grow-1 d-flex align-items-center",style:this.fontSizeStyle,title:r},r),i.jsx(a.Button,{size:"sm",icon:!0,type:"tertiary",className:"flex-shrink-0 text-center px-2 pt-1",style:this.cursorStyle,onClick:function(){return e.props.onClose()}},i.jsx(a.Icon,{icon:l,size:"16"}))),i.jsx("div",{style:this.overflowYStyle},i.jsx(p.default,s({},this.props)))))))},t}(i.React.PureComponent),d=i.themeUtils.withTheme(i.injectIntl(u));t.default=d},712:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(713);n(0).ThemeManager.getInstance().registerJimuThemeStyleModule("jimu-ui/expression-builder/",{componentStyles:r}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(717))},713:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(714);t.ExpressionBuilder=r.expressionBuilderStyles;var o=n(715);t.ExpressionEditor=o.expressionEditorStyles;var s=n(716);t.ExpressionInput=s.expressionInputStyles},714:function(e,t,n){"use strict";var r=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var o,s=n(0);t.expressionBuilderStyles=function(e){var t=e.theme;return s.css(o||(o=r(["\n    .component-expression-builder{\n      .w-33{\n        width: 33% !important;\n      }\n      .secondary-title{\n        font-size: ",";\n        color: ",";\n        font-weight: 400;\n      }\n      .expression-builder-tab{\n        padding: 1rem;\n        overflow: auto;\n        width: 100%;\n        height: calc(100% - 50px);\n      }\n      .statistics-tab{\n        .mb-12{\n          margin-bottom: 12px;\n        }\n        .option-label{\n          font-size: ",";\n          font-weight: 500;\n          color: ",";\n        }\n      }\n      .field-selector-container, .expression-editor-container{\n        width: 100%;\n      }\n      .expression-insert-btn{\n        height: ",";\n      }\n      .expression-insert-btn{\n        max-width: 100%;\n        >button{\n          max-width: 100%;\n        }\n      }\n\n    }\n\n  "],["\n    .component-expression-builder{\n      .w-33{\n        width: 33% !important;\n      }\n      .secondary-title{\n        font-size: ",";\n        color: ",";\n        font-weight: 400;\n      }\n      .expression-builder-tab{\n        padding: 1rem;\n        overflow: auto;\n        width: 100%;\n        height: calc(100% - 50px);\n      }\n      .statistics-tab{\n        .mb-12{\n          margin-bottom: 12px;\n        }\n        .option-label{\n          font-size: ",";\n          font-weight: 500;\n          color: ",";\n        }\n      }\n      .field-selector-container, .expression-editor-container{\n        width: 100%;\n      }\n      .expression-insert-btn{\n        height: ",";\n      }\n      .expression-insert-btn{\n        max-width: 100%;\n        >button{\n          max-width: 100%;\n        }\n      }\n\n    }\n\n  "])),s.polished.rem(14),t.colors.palette.dark[400],s.polished.rem(13),t.colors.palette.dark[400],s.polished.rem(30))}},715:function(e,t,n){"use strict";var r=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var o,s=n(0);t.expressionEditorStyles=function(e){var t=e.theme;return s.css(o||(o=r(["\n    .component-expression-editor{\n      .mt-18{\n        margin-top: 18px;\n      }\n      .mt-12{\n        margin-top: 12px;\n      }\n      .expression-editor-input{\n        -webkit-user-select: text !important;\n        user-select: text !important;\n        font-size: 13px;\n        font-weight: 400;\n        overflow: hidden;\n        min-height: ",";\n        user-select: none;\n        border: 0;\n        outline: none;\n        .expression-editor-input-content-editable:focus{\n          border-color: ",";\n          outline: none;\n        }\n        .expression-editor-input-content-editable{\n          min-height: ",";\n          border: 1px solid ",";\n          background-color: ",";\n          border-radius: 2px;\n          outline: none;\n        }\n        p{\n          min-height: 100%;\n        }\n        .break-all{\n          word-break: break-all;\n        }\n        span.error-exp{\n          color: #FF5066;\n        }\n        .field-exp{\n          color: #FFDE72;\n        }\n        .function-exp{\n          color: #B685FF;\n        }\n        .number-exp{\n          color: #74D3FF;\n        }\n        .string-exp{\n          color: #98FF64;\n        }\n        .operator-exp{\n          color: #F5A623;\n        }\n        .unknown-exp{\n          color: #FF5066;\n        }\n        .ds-disabled-exp{\n          color: #FF5066;\n        }\n      }\n\n      .error-border{\n        border: 1px solid #FF5066;\n        outline: none;\n        .expression-editor-input-content-editable{\n          outline: none;\n          border: 0;\n        }\n      }\n\n      .expression-editor-function-item{\n        border: 1px solid transparent;\n        cursor: pointer;\n        background-color: ",";\n        user-select: none;\n      }\n      .expression-editor-function-item:hover{\n        background-color: ",";\n      }\n      .expression-editor-function-item:active.expression-editor-function-item:hover{\n        background-color: ",";\n      }\n\n      .exp-editor-helper-tab{\n        overflow-y: auto;\n        margin-left: -16px;\n        margin-right: -16px;\n      }\n\n      .error-message{\n        height: 20px;\n        line-height: 20px;\n      }\n\n      .exp-poper{\n        background-color: ",";\n        border: 1px solid ",";\n        font-size: 13px;\n        width: ",";\n        z-index: 1;\n        padding: 0 !important;\n        box-shadow: 0 0 8px 0 ",";\n        .exp-popper-item{\n          padding-left: 8px;\n          padding-right: 8px;\n        }\n        .jimu-popper--arrow::after {\n          border-bottom-color: "," !important;\n        }\n      }\n      .exp-popper-selected-item, .exp-popper-item:hover{\n        background-color: ",";\n        cursor: pointer;\n      }\n\n    }\n\n  "],["\n    .component-expression-editor{\n      .mt-18{\n        margin-top: 18px;\n      }\n      .mt-12{\n        margin-top: 12px;\n      }\n      .expression-editor-input{\n        -webkit-user-select: text !important;\n        user-select: text !important;\n        font-size: 13px;\n        font-weight: 400;\n        overflow: hidden;\n        min-height: ",";\n        user-select: none;\n        border: 0;\n        outline: none;\n        .expression-editor-input-content-editable:focus{\n          border-color: ",";\n          outline: none;\n        }\n        .expression-editor-input-content-editable{\n          min-height: ",";\n          border: 1px solid ",";\n          background-color: ",";\n          border-radius: 2px;\n          outline: none;\n        }\n        p{\n          min-height: 100%;\n        }\n        .break-all{\n          word-break: break-all;\n        }\n        span.error-exp{\n          color: #FF5066;\n        }\n        .field-exp{\n          color: #FFDE72;\n        }\n        .function-exp{\n          color: #B685FF;\n        }\n        .number-exp{\n          color: #74D3FF;\n        }\n        .string-exp{\n          color: #98FF64;\n        }\n        .operator-exp{\n          color: #F5A623;\n        }\n        .unknown-exp{\n          color: #FF5066;\n        }\n        .ds-disabled-exp{\n          color: #FF5066;\n        }\n      }\n\n      .error-border{\n        border: 1px solid #FF5066;\n        outline: none;\n        .expression-editor-input-content-editable{\n          outline: none;\n          border: 0;\n        }\n      }\n\n      .expression-editor-function-item{\n        border: 1px solid transparent;\n        cursor: pointer;\n        background-color: ",";\n        user-select: none;\n      }\n      .expression-editor-function-item:hover{\n        background-color: ",";\n      }\n      .expression-editor-function-item:active.expression-editor-function-item:hover{\n        background-color: ",";\n      }\n\n      .exp-editor-helper-tab{\n        overflow-y: auto;\n        margin-left: -16px;\n        margin-right: -16px;\n      }\n\n      .error-message{\n        height: 20px;\n        line-height: 20px;\n      }\n\n      .exp-poper{\n        background-color: ",";\n        border: 1px solid ",";\n        font-size: 13px;\n        width: ",";\n        z-index: 1;\n        padding: 0 !important;\n        box-shadow: 0 0 8px 0 ",";\n        .exp-popper-item{\n          padding-left: 8px;\n          padding-right: 8px;\n        }\n        .jimu-popper--arrow::after {\n          border-bottom-color: "," !important;\n        }\n      }\n      .exp-popper-selected-item, .exp-popper-item:hover{\n        background-color: ",";\n        cursor: pointer;\n      }\n\n    }\n\n  "])),s.polished.rem(100),t.colors.palette.primary[700],s.polished.rem(100),t.colors.palette.light[200],t.colors.palette.light[200],t.colors.palette.light[400],t.colors.palette.light[500],t.colors.white,t.colors.palette.light[200],t.colors.palette.light[800],s.polished.rem(150),s.polished.rgba(t.colors.white,.5),t.colors.palette.light[200],t.colors.secondary)}},716:function(e,t,n){"use strict";var r=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var o,s=n(0);t.expressionInputStyles=function(e){var t=e.theme;return s.css(o||(o=r(["\n    .component-expression-input{\n      font-size: ",";\n      .disabled-input-cover{\n        width: 100%;\n        height: 100%;\n        position: relative;\n        top: -100%;\n        &.ds-disabled{\n          background-color: transparent;\n        }\n      }\n      .ds-disabled{\n        background-color: ",";\n        cursor: pointer;\n        border: 0;\n        >span{\n          color: ",";\n          background-color: ",";\n          vertical-align: sub;\n          margin-left: 5px;\n          margin-right: 5px;\n        }\n      }\n      .ds-placeholder{\n        >span{\n          color: ",";\n          background-color: ",";\n        }\n      }\n      .expression-builder-trigger{\n        cursor: pointer;\n        width: 26px;\n        height: 26px;\n        padding: 0;\n        .dropdown-button-content{\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n        .expression-builder-trigger-dropdown{\n          padding: 0;\n          .trigger-dropdown-toggle{\n            background: ",";\n            border-radius: 2px 0 0 2px;\n            border-color: ",";\n          }\n        }\n      }\n      .expression-input{\n        height: ",";\n        .jimu-input, .ds-placeholder{\n          border-radius: 0 2px 2px 0;\n        }\n      }\n    }\n\n  "],["\n    .component-expression-input{\n      font-size: ",";\n      .disabled-input-cover{\n        width: 100%;\n        height: 100%;\n        position: relative;\n        top: -100%;\n        &.ds-disabled{\n          background-color: transparent;\n        }\n      }\n      .ds-disabled{\n        background-color: ",";\n        cursor: pointer;\n        border: 0;\n        >span{\n          color: ",";\n          background-color: ",";\n          vertical-align: sub;\n          margin-left: 5px;\n          margin-right: 5px;\n        }\n      }\n      .ds-placeholder{\n        >span{\n          color: ",";\n          background-color: ",";\n        }\n      }\n      .expression-builder-trigger{\n        cursor: pointer;\n        width: 26px;\n        height: 26px;\n        padding: 0;\n        .dropdown-button-content{\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n        .expression-builder-trigger-dropdown{\n          padding: 0;\n          .trigger-dropdown-toggle{\n            background: ",";\n            border-radius: 2px 0 0 2px;\n            border-color: ",";\n          }\n        }\n      }\n      .expression-input{\n        height: ",";\n        .jimu-input, .ds-placeholder{\n          border-radius: 0 2px 2px 0;\n        }\n      }\n    }\n\n  "])),t.typography.fontSizeBase,t.colors.palette.light[200],t.colors.dark,s.polished.rgba(t.colors.palette.danger[600],.5),t.colors.palette.dark[400],t.colors.transparent,t.colors.palette.light[600],t.colors.palette.light[600],s.polished.rem(26))}},717:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(426);t.ExpressionEditor=r.default;var o=n(429);t.ExpressionBuilder=o.default;var s=n(430);t.ExpressionBuilderPopup=s.default;var i=n(733);t.ExpressionInput=i.default;var a=n(150);t.ExpressionFrom=a.ExpressionFrom,t.ExpressionInputFrom=a.ExpressionInputFrom},718:function(e,t){e.exports=r},719:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=a(n(1)),l=p(n(720)),u=a(n(2));function d(e){return e&&e.replace(/&nbsp;|\u202F|\u00A0/g," ")}function f(e){var t=function e(t){if(t.nodeType===Node.TEXT_NODE)return t;for(var n=t.childNodes,r=n.length-1;r>=0;r--){var o=e(n[r]);if(null!==o)return o}return null}(e),n=document.activeElement===e;if(null!==t&&null!==t.nodeValue&&n){var r=window.getSelection();if(null!==r){var o=document.createRange();o.setStart(t,t.nodeValue.length),o.collapse(!0),r.removeAllRanges(),r.addRange(o)}e instanceof HTMLElement&&e.focus()}}var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastHtml=t.props.html,t.el="function"==typeof t.props.innerRef?{current:null}:c.createRef(),t.getEl=function(){return(t.props.innerRef&&"function"!=typeof t.props.innerRef?t.props.innerRef:t.el).current},t.emitChange=function(e){var n=t.getEl();if(n){var r=n.innerHTML;if(t.props.onChange&&r!==t.lastHtml){var o=Object.assign({},e,{target:{value:r}});t.props.onChange(o)}t.lastHtml=r}},t}return o(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.tagName,r=t.html,o=t.innerRef,a=i(t,["tagName","html","innerRef"]);return c.createElement(n||"div",s({},a,{ref:"function"==typeof o?function(t){o(t),e.el.current=t}:o||this.el,onInput:this.emitChange,onBlur:this.props.onBlur||this.emitChange,onKeyUp:this.props.onKeyUp||this.emitChange,onKeyDown:this.props.onKeyDown||this.emitChange,contentEditable:!this.props.disabled,dangerouslySetInnerHTML:{__html:r}}),this.props.children)},t.prototype.shouldComponentUpdate=function(e){var t=this.props,n=this.getEl();return!n||(d(e.html)!==d(n.innerHTML)||(t.disabled!==e.disabled||t.tagName!==e.tagName||t.className!==e.className||t.innerRef!==e.innerRef||!l.default(t.style,e.style)))},t.prototype.componentDidUpdate=function(){var e=this.getEl();e&&(this.props.html!==e.innerHTML&&(e.innerHTML=this.lastHtml=this.props.html),f(e))},t.propTypes={html:u.string.isRequired,onChange:u.func,disabled:u.bool,tagName:u.string,className:u.string,style:u.object,innerRef:u.oneOfType([u.object,u.func])},t}(c.Component);t.default=h},720:function(e,t,n){"use strict";var r=Array.isArray,o=Object.keys,s=Object.prototype.hasOwnProperty;e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){var i,a,p,c=r(t),l=r(n);if(c&&l){if((a=t.length)!=n.length)return!1;for(i=a;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(c!=l)return!1;var u=t instanceof Date,d=n instanceof Date;if(u!=d)return!1;if(u&&d)return t.getTime()==n.getTime();var f=t instanceof RegExp,h=n instanceof RegExp;if(f!=h)return!1;if(f&&h)return t.toString()==n.toString();var x=o(t);if((a=x.length)!==o(n).length)return!1;for(i=a;0!=i--;)if(!s.call(n,x[i]))return!1;for(i=a;0!=i--;)if(!e(t[p=x[i]],n[p]))return!1;return!0}return t!=t&&n!=n}},721:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(151),p=function(e){function t(t){var n=e.call(this,t)||this;return n.getDsLabel=function(){var e=i.DataSourceManager.getInstance(),t=e&&e.getDataSource(n.props.dataSourceId);return t?t.label:null},n}return o(t,e),t.prototype.render=function(){var e;return i.React.createElement(a.default,s({},this.props,{className:i.classNames("field-exp",(e={},e[this.props.className]=!!this.props.className,e["error-exp"]=this.props.isError,e["ds-disabled-exp"]=this.props.isDsDisabled,e)),style:this.props.style,title:this.getDsLabel(),tabIndex:0}))},t}(i.React.PureComponent);t.default=p},722:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(151),p=function(e){function t(t){var n=e.call(this,t)||this;return n.state={},n}return o(t,e),t.prototype.render=function(){return i.React.createElement(a.default,s({},this.props,{className:"string-exp",tabIndex:0}))},t}(i.React.PureComponent);t.default=p},723:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),i=function(e){function t(t){var n=e.call(this,t)||this;return n.getFunctionTooltip=function(e){if(!e)return null;switch(n.props.exp){case s.ExpressionFunctions.Average:return"Average ( fieldName ) returns  { Number }";case s.ExpressionFunctions.Count:return"Count ( ) returns  { Number }";case s.ExpressionFunctions.Sum:return"Sum ( fieldName ) returns  { Number }";case s.ExpressionFunctions.Max:return"Max ( fieldName ) returns  { Number }";case s.ExpressionFunctions.Min:return"Min ( fieldName ) returns  { Number }";default:return null}},n}return o(t,e),t.prototype.render=function(){var e;return s.React.createElement("span",{className:s.classNames("function-exp",(e={},e[this.props.className]=!!this.props.className,e["ds-disabled-exp"]=this.props.isDsDisabled,e)),contentEditable:!!this.props.isEditable,suppressContentEditableWarning:!0,id:this.props.id,title:this.getFunctionTooltip(this.props.exp)},this.props.exp)},t}(s.React.PureComponent);t.default=i},724:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(151),p=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.render=function(){var e;return i.React.createElement(a.default,s({},this.props,{className:i.classNames("number-exp",(e={},e[this.props.className]=!!this.props.className,e)),style:this.props.style,tabIndex:0}))},t}(i.React.PureComponent);t.default=p},725:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(151),p=function(e){function t(t){var n=e.call(this,t)||this;return n.state={},n}return o(t,e),t.prototype.render=function(){return i.React.createElement(a.default,s({},this.props,{className:"unknown-exp"}))},t}(i.React.PureComponent);t.default=p},726:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(151),p=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.render=function(){return i.React.createElement(a.default,s({},this.props,{className:"operator-exp"}))},t}(i.React.PureComponent);t.default=p},727:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),i=n(3),a=function(e){function t(t){var n=e.call(this,t)||this;return n.itemHeight=25,n.popoverItemStyle={height:n.itemHeight+"px !important",lineHeight:n.itemHeight+"px !important"},n.checkTarget=function(e){return!!e&&!(!document||!document.getElementById(e))},n}return o(t,e),t.prototype.componentDidUpdate=function(e){if(this.props.selectedItemIndex!==e.selectedItemIndex&&this.props.selectedItemIndex&&this.root){var t=void 0;if(parseInt(this.props.selectedItemIndex)>parseInt(e.selectedItemIndex))if(parseInt(this.props.selectedItemIndex)===this.props.items.length-1)t=this.root.scrollHeight-this.root.offsetHeight;else{var n=Math.floor((this.root.scrollTop+this.root.offsetHeight)/this.itemHeight)-1;t=parseInt(this.props.selectedItemIndex)>=n?this.root.scrollTop+this.itemHeight:this.root.scrollTop}else if(0===parseInt(this.props.selectedItemIndex))t=0;else{var r=Math.floor(this.root.scrollTop/this.itemHeight);t=parseInt(this.props.selectedItemIndex)<=r?this.root.scrollTop-this.itemHeight:this.root.scrollTop}this.root.scrollTo(null,t)}},t.prototype.render=function(){var e=this;return this.props.targetNodeId&&this.checkTarget(this.props.targetNodeId)&&this.props.items&&0!==this.props.items.length?s.jsx(i.Popper,{reference:this.props.targetNodeId,open:!0,placement:"bottom",className:"exp-poper",offset:[0,5],modifiers:{arrow:{enabled:!0}}},s.jsx("div",{style:{width:"150px",maxHeight:"150px",overflow:"auto"},ref:function(t){return e.root=t}},this.props.items.map((function(t,n){return s.jsx("div",{key:n,onClick:function(){return e.props.onClick&&e.props.onClick(t,e.props.targetNodeId)},className:s.classNames("text-truncate exp-popper-item",{"exp-popper-selected-item":""+n===e.props.selectedItemIndex}),title:t.content,css:s.css(e.popoverItemStyle)},t.content)})))):null},t}(s.React.PureComponent);t.default=a},728:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,o++)r[o]=s[i];return r};Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(0),p=n(3),c=n(427);!function(e){e.Fields="FIELDS",e.Functions="FUNCTIONS"}(i||(i={}));var l=function(e){function t(t){var n,r=e.call(this,t)||this;return r.dsManager=a.DataSourceManager.getInstance(),r.__unmount=!1,r.ExpEditorHelperTabs=((n={})[i.Fields]=r.props.intl.formatMessage({id:"fields",defaultMessage:p.defaultMessages.fields}),n[i.Functions]=r.props.intl.formatMessage({id:"functions",defaultMessage:p.defaultMessages.functions}),n),r.getDataSources=function(){var e=[];return r.props.dataSourceIds&&(e=r.props.dataSourceIds.asMutable().map((function(e){return r.dsManager&&r.dsManager.getDataSource(e)})).filter((function(e){return!!e}))),e},r.getTab=function(e){var t=r.state.FieldSelector;switch(e){case i.Fields:return t&&a.React.createElement(t,{dataSources:r.getDataSources(),onSelect:r.onFieldSelect});case i.Functions:return a.React.createElement(u,{onSelect:r.onFunctionSelect});default:return null}},r.onFunctionSelect=function(e){if(e){var t={type:a.ExpressionPartType.Function,exp:e};r.props.dataSourceIds&&1===r.props.dataSourceIds.length&&c.isNeedDataSourceFunction(e)&&(t.dataSourceId=r.props.dataSourceIds&&r.props.dataSourceIds[0]);var n=[t,{type:a.ExpressionPartType.Operator,exp:"("},{type:a.ExpressionPartType.Operator,exp:")"}];r.changeExpression(n,r.props.expression)}},r.onFieldSelect=function(e,t,n){if(t&&n){var o={type:a.ExpressionPartType.Field,exp:"{"+(t.alias||t.name)+"}",dataSourceId:n.id,jimuFieldName:t.jimuName};r.changeExpression([o],r.props.expression)}},r.onActiveTabChange=function(e){r.setState({active:e})},r.getSelectionPartId=function(){var e,t;if(r.props.inEditablePart){var n=c.getSelectionPosInnerPart(r.props.externalId,r.props.container);t=n&&n.partId}else{var o=c.getPreviousNodeOfSelection(r.props.externalId);t=o&&o.id}return(t=t||(null===(e=r.props.expSelection)||void 0===e?void 0:e.partId))||(t=c.getPartIdByIndex(r.props.externalId,0)),t},r.changeExpression=function(e,t){if(e){var n,o,i=r.getSelectionPartId(),a=t,p=a&&a.parts&&a.parts.slice()||[];if(0===p.length)n=0,o=c.getPartIdByIndex(r.props.externalId,n),p=e;else{var l=c.getIndexByPartId(r.props.externalId,i);n=c.areFunctionParts(e)?l+1:l+e.length,p.splice.apply(p,s([n,0],e)),o=c.getPartIdByIndex(r.props.externalId,n)}r.props.onSelect({name:a&&a.name||r.props.externalId,parts:p},o)}},r.state={active:i.Fields,FieldSelector:null},r}return o(t,e),t.prototype.componentDidMount=function(){var e=this;this.__unmount=!1,a.moduleLoader.loadModule("jimu-ui/data-source-selector").then((function(t){return!e.__unmount&&e.setState({FieldSelector:t.FieldSelector})}))},t.prototype.componentWillUnmount=function(){this.__unmount=!0},t.prototype.render=function(){var e=this;return this.props.container?a.React.createElement("div",{className:"exp-editor-helper"},a.React.createElement(p.Nav,{fill:!0,pills:!0},Object.keys(i).map((function(t,n){return a.React.createElement(p.NavItem,{key:n,style:{width:100/Object.keys(i).length+"%"}},a.React.createElement(p.NavLink,{className:"text-truncate",onClick:function(){e.onActiveTabChange(i[t])},active:e.state.active===i[t]},e.ExpEditorHelperTabs[i[t]]))}))),a.React.createElement("div",{className:"exp-editor-helper-tab"},this.getTab(this.state.active))):null},t}(a.React.PureComponent);t.default=l;var u=function(e){var t=e.onSelect;return a.React.createElement("div",{className:"mt-18 px-3"},Object.keys(a.ExpressionFunctions).map((function(e,n){return a.React.createElement("div",{onClick:function(){return t(a.ExpressionFunctions[e])},key:n,className:"mt-12 p-1 expression-editor-function-item"},a.ExpressionFunctions[e])})))}},729:function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,o++)r[o]=s[i];return r};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(320),i=n(428),a=n(196);function p(e){var t=c(e.replace(/\ufeff/g,""));return t=u(t=l(t))}function c(e){var t=e.split(/([\"])/g).filter((function(e){return!!e})),n="",r=!1,o=!1,s=[];return t.forEach((function(e,i){'"'===e?(n+=e,o=r,(r=!0)&&o&&(s.push(n),n="",r=!1,o=!1)):r?n+=e:s.push(e),i===t.length-1&&r&&!o&&s.push(n)})),s}function l(e){var t=e.map((function(e){return s.isString(e)?e:e.split(/({[^\{\}]*})/g).filter((function(e){return!!e}))}));return t=Array.prototype.concat.apply([],t)}function u(e){var t=e.map((function(e){return s.isString(e)||s.isField(e)?e:e.split(/(\s*[\+\-\*\/\(\)\s]\s*)/g).filter((function(e){return!!e}))}));return t=Array.prototype.concat.apply([],t)}function d(e,t,n,r,o){var i={};return!e||!s.isNumberVariable(t)||t<0?i:(e.forEach((function(e,a){var p=s.isNumberVariable(n)&&n>-1&&a===n,c=s.isNumberVariable(o)&&o>-1&&a===o?r:null;i[t+a]={part:e,isReplacing:p,startOffset:c}})),i)}function f(e,t){if(!e||!t)return null;var n=o.DataSourceManager.getInstance().getDataSource(e),r=n&&n.getSchema&&n.getSchema(),s=r&&r.fields;return s&&Object.keys(s).sort((function(e,t){return e.localeCompare(t)})).find((function(e){return(s[e].alias||s[e].name)===t}))||null}function h(e,t,n){return s.isField(e)?{type:o.ExpressionPartType.Field,exp:e,dataSourceId:t,jimuFieldName:n||f(t,e.replace(/^\{/,"").replace(/\}$/,""))}:s.isFunction(e)?{type:o.ExpressionPartType.Function,exp:e,dataSourceId:(r=e,r&&r===o.ExpressionFunctions.Count?t:void 0)}:s.isNumber(e)?{type:o.ExpressionPartType.Number,exp:e}:s.isOperator(e)?{type:o.ExpressionPartType.Operator,exp:e}:s.isString(e)?{type:o.ExpressionPartType.String,exp:e}:{type:o.ExpressionPartType.Unknown,exp:e};var r}function x(e,t,n,r){if(void 0===t&&(t=[]),!t||!s.isNumberVariable(n)||!s.isNumberVariable(r))return null;var o=t[n-1],i=t[r+1],a={};if(o&&i&&!s.isPartUnmergeable(o)&&!s.isPartUnmergeable(i))for(var c=p(o.exp+i.exp).map((function(e,t){return h(e)})),l=n-1;l<=r+1;l++)a[l]={part:c[l-(n-1)]||null,isReplacing:!0,startOffset:c[l-(n-1)]?o.exp.length:null};else for(l=n;l<=r;l++)a[l]={part:null,isReplacing:!0,startOffset:null};return a}function g(e){var t=[],n=e&&e.map((function(e){return o.DataSourceManager.getInstance().getDataSource(e)})).filter((function(e){return!!e}));return n&&s.getSortedArrayByLabel(n).forEach((function(e){t.push({id:e.id,content:e.label,type:a.PopoverType.DataSource})})),t}t.getExps=p,t.handleStringExps=c,t.handleFieldExps=l,t.handleOperatoExps=u,t.addCharactersToParts=function(e,t,n,r,o,i,a){void 0===t&&(t=[]);var c={};if(!n)return c;t=t||[];var l=a?s.getIndexByPartId(e,a.id):t.length,u=s.isCharDoubleQuotationMarker(n)?'""':s.isCharFrontCurlyBracket(n)?"{}":n,f=o&&1===o.length?o[0]:void 0,x=p(u).map((function(e){return h(e,f)})),g=x[0]&&1===x[0].exp.length?s.isCharacterUnmergeable(x[0].exp):s.isPartUnmergeable(x[0]),m=x[x.length-1]&&1===x[x.length-1].exp.length?s.isCharacterUnmergeable(x[x.length-1].exp):s.isPartUnmergeable(x[x.length-1]);if(r){var y=l-1>0?l-1:0,v=t[y],b=s.isPartUnmergeable(v),I=i&&i.startOffset,E=i&&i.startContainer,S=!(!I||I!==n.length),P=!(!I||!E||I!==E.textContent.length);if(b)if(S){var O=t[M=y-1];if(s.isPartUnmergeable(O)||g)c=d(x,y);else c=d(R=p(O.exp+u).map((function(e){return h(e,f)})),M,0,R[R.length-1].exp.length,R.length-1)}else if(P){var _=t[l];if((k=s.isPartUnmergeable(_))||m)c=d(x,l);else{var F=(R=p(u+_.exp).map((function(e){return h(e,f)})))[R.length-1].exp.length-_.exp.length>-1?R[R.length-1].exp.length-_.exp.length:R[R.length-1].exp.length;c=d(R,l,R.length-1,F,R.length-1)}}else{var C=t[y],N=E&&E.textContent,w=C&&N&&h(N,C.dataSourceId,C.jimuFieldName);c[y]={part:w,isReplacing:!0,startOffset:i&&i.startOffset}}else if(S)if(m)c=d(x,y);else{var j=(R=p(u+v.exp).map((function(e){return h(e,f)})))[R.length-1].exp.length-v.exp.length>-1?R[R.length-1].exp.length-v.exp.length:R[R.length-1].exp.length;c=d(R,y,R.length-1,j,R.length-1)}else if(P){if(g)c=d(x,l);else c=d(R=p(v.exp+u).map((function(e){return h(e,f)})),y,0,R[0].exp.length,0)}else{var T=p((E&&E.textContent).replace(/\"/g,'""').replace(/\{/g,"{}")).map((function(e){return h(e,f)}));c=d(T,y,0,j=1===T.length?I:T[T.length-1].exp.length,1===T.length?0:T.length-1)}}else{_=t[l],O=t[M=l-1>0?l-1:0];var M,D=s.isPartUnmergeable(O),k=s.isPartUnmergeable(_);if(D&&k)c=d(x,l);else if(k)if(D)console.warn("One mergeable part can not be next to another mergeable part");else{if(g)c=d(x,l);else c=d(R=p(O.exp+u).map((function(e){return h(e,f)})),M,0,R[0].exp.length,0)}else if(m)c=d(x,l);else{var R;I=(R=p(u+_.exp).map((function(e){return h(e,f)})))[R.length-1].exp.length-_.exp.length>-1?R[R.length-1].exp.length-_.exp.length:R[R.length-1].exp.length;c=d(R,l,R.length-1,I,R.length-1)}}return c},t.applyEditResultToParts=function(e,t){if(void 0===t&&(t=[]),!e)return t;var n=(t=t||[]).slice(),o=0,s=[];return Object.keys(e).sort((function(e,t){return parseInt(e)-parseInt(t)})).forEach((function(t){o+=e[t].isReplacing?1:0,e[t].part&&s.push(e[t].part)})),n.splice.apply(n,r([Math.min.apply(null,Object.keys(e)),o],s)),n},t.getWhetherPartNeedPopover=function(e){return!!e&&(e===o.ExpressionPartType.Field||e===o.ExpressionPartType.Function)},t.getExpressionPart=h,t.removeParts=x,t.removeCharactersFromOnePart=function(e,t,n,r,o){void 0===t&&(t=[]);var i=s.getIndexByPartId(e,n),a=t&&t[i];if(!a||!a.exp||!s.isNumberVariable(r)||!s.isNumberVariable(o)||r<0||o<0)return null;var c,l,u={},d=a.exp.slice(r,o+1),f=0===r,g=o===a.exp.length-1;if((l=h(c=(f||g)&&s.isCharDoubleQuotationMarker(d)?a.exp.replace(/^\"/,"").replace(/\"$/,""):f&&s.isCharFrontCurlyBracket(d)||g&&s.isCharPostCurlyBracket(d)?a.exp.replace(/^\{/,"").replace(/\}$/,""):""+a.exp.slice(0,r)+a.exp.slice(o+1),a.dataSourceId,a.jimuFieldName)).exp.length>0)if(s.isPartUnmergeable(l))u[i]={part:l,isReplacing:!0,startOffset:r+1-(o-r+1)};else{var m=t[i-1],y=t[i+1],v=p(c.replace(/\"/g,'""').replace(/\{/g,"{}")).map((function(e){return h(e)})),b=s.isPartUnmergeable(m),I=s.isPartUnmergeable(y),E=void 0,S=void 0;m&&y&&!b&&!I?(S=m.exp+c+y.exp,E=2):m&&!b?(S=m.exp+c,E=1):y&&!I?(S=c+y.exp,E=1):(S=c,E=0);var P=void 0,O=void 0;m&&!b?(P=i-1,O=f?m.exp.length:g?v[v.length-1].exp.length:0):(P=i,O=f?0:g?v[v.length-1].exp.length:0);for(var _=p(S.replace(/\"/g,'""').replace(/\{/g,"{}")).map((function(e){return h(e)})),F=f?P:g?P+_.length-1:null,C=P;C<=P+_.length+E-1;C++)u[C]={part:_[C-P]||null,isReplacing:C-P<=E,startOffset:C===F?O:null}}else u=x(0,t,i,i);return u},t.getPopoverItems=function(e,t,n,r){if(void 0===n&&(n=[]),!t||!n)return[];var i=[],p=s.getIndexByPartId(e,t),c=n[p];if(c){if(c.type===o.ExpressionPartType.Field)if(c.dataSourceId){var l=o.DataSourceManager.getInstance().getDataSource(c.dataSourceId),u=l&&l.getSchema&&l.getSchema().fields;u&&Object.keys(u).filter((function(e){var t=u[e].alias||u[e].name;return t&&0===t.toLowerCase().indexOf(c.exp.replace(/[\{\}]/g,"").toLowerCase())})).filter((function(e){return!n[p-1]||n[p-1].type!==o.ExpressionPartType.Operator||"("!==n[p-1].exp||!n[p-2]||n[p-2].type!==o.ExpressionPartType.Function||u[e].type===o.JimuFieldType.Number})).sort((function(e,t){return u[e].name.localeCompare(u[t].name)})).forEach((function(e){i.push({id:e,content:u[e].alias||u[e].name,type:a.PopoverType.Field})}))}else r&&r.length>0&&(i=g(r));else c.type===o.ExpressionPartType.Unknown?s.getSortedKeys(o.ExpressionFunctions).filter((function(e){return 0===o.ExpressionFunctions[e].toLowerCase().indexOf(c.exp.toLowerCase())})).forEach((function(e){i.push({id:e,content:o.ExpressionFunctions[e],type:a.PopoverType.Function})})):c.type===o.ExpressionPartType.Function&&c.exp===o.ExpressionFunctions.Count&&r&&r.length>1&&(i=g(r));return i}},t.getPopoverTarget=function(e,t,n){if(!document||!document.querySelector("#"+e))return null;for(var r=i.getPreviousNodeOfSelection(e);r&&n[s.getIndexByPartId(e,r.id)]&&n[s.getIndexByPartId(e,r.id)].type===o.ExpressionPartType.Operator;)r=r.previousElementSibling;return!t&&r?r.id:i.getPartIdOfSelection(e)}},730:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),i=n(149),a=function(e){function t(t){var n=e.call(this,t)||this;return n.dsManager=s.DataSourceManager.getInstance(),n.__unmount=!1,n.getSelectedFields=function(){var e;if(!n.props.expression)return null;var t=n.props.expression.parts&&n.props.expression.parts[0],r=t&&i.getWhetherUseDssMatchExpDss(t,n.props.dataSourceIds.asMutable())&&t.type===s.ExpressionPartType.Field?t.jimuFieldName:null;if(r){if(n.props.dataSourceIds&&n.props.dataSourceIds.length>0){var o=t.dataSourceId;return o?s.Immutable(((e={})[o]=[r],e)):null}return s.Immutable([r])}return null},n.getDataSources=function(){var e=[];return n.props.dataSourceIds&&(e=n.props.dataSourceIds.asMutable().map((function(e){return n.dsManager&&n.dsManager.getDataSource(e)})).filter((function(e){return!!e}))),e},n.onSelect=function(e,t,r){if(t&&r){var o={type:s.ExpressionPartType.Field,exp:"{"+(t.alias||t.name)+"}",dataSourceId:r.id,jimuFieldName:t.jimuName};n.props.onChange({name:o.exp,parts:[o]})}},n.state={FieldSelector:null},n}return o(t,e),t.prototype.componentDidMount=function(){var e=this;this.__unmount=!1,s.moduleLoader.loadModule("jimu-ui/data-source-selector").then((function(t){return!e.__unmount&&e.setState({FieldSelector:t.FieldSelector})}))},t.prototype.componentWillUnmount=function(){this.__unmount=!0},t.prototype.render=function(){var e=this.state.FieldSelector;return s.React.createElement("div",{className:"expression-builder-tab attribute-tab p-0"},s.React.createElement("div",{className:"field-selector-container h-100"},e&&s.React.createElement(e,{types:this.props.types,dataSources:this.getDataSources(),onSelect:this.onSelect,selectedFields:this.getSelectedFields()})))},t}(s.React.PureComponent);t.default=a},731:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(3),p=n(426),c=function(e){function t(n){var r=e.call(this,n)||this;return r.getMutableExpression=function(e){return r.props.expression&&r.props.expression.asMutable?r.props.expression.asMutable({deep:!0}):r.props.expression},r.onExpChange=function(e){r.setState({expression:e})},r.onChange=function(){r.props.onChange({name:r.state.name||r.getDefaultName(),parts:r.state.expression&&r.state.expression.parts})},r.onNameChange=function(e){r.setState({name:e.target.value})},r.getDefaultName=function(){return r.props.intl.formatMessage({id:"expression",defaultMessage:a.defaultMessages.expression})+" "+t.count},r.getWhetherDisableInsert=function(){return!r.state.expression||!r.state.expression.parts||0===r.state.expression.parts.length||!i.expressionUtils.getWhetherExpressionValid(r.state.expression)},t.count++,r.state={expression:r.getMutableExpression(r.props.expression),name:r.props.expression&&r.props.expression.name||r.getDefaultName()},r}return o(t,e),t.prototype.componentDidUpdate=function(e){e.expression!==this.props.expression&&this.setState({expression:this.getMutableExpression(this.props.expression)})},t.prototype.render=function(){return i.React.createElement("div",{className:"expression-builder-tab expression-tab"},i.React.createElement("div",{className:"mb-2"},i.React.createElement(a.Label,{for:"expression-name-input",className:"w-100 text-truncate d-block option-label secondary-title",title:this.props.intl.formatMessage({id:"name",defaultMessage:a.defaultMessages.name})+": "},""+this.props.intl.formatMessage({id:"name",defaultMessage:a.defaultMessages.name})),i.React.createElement(a.TextInput,{className:"flex-grow-1",value:this.state.name,onChange:this.onNameChange,id:"expression-name-input"})),i.React.createElement("div",{className:"d-flex justify-content-end my-3"},i.React.createElement(a.Button,{onClick:this.onChange,type:"primary",disabled:this.getWhetherDisableInsert(),className:"expression-insert-btn"},i.React.createElement("div",{className:"text-truncate"},this.props.intl.formatMessage({id:"insert",defaultMessage:a.defaultMessages.insert})))),i.React.createElement("div",{className:"expression-editor-container"},i.React.createElement(p.default,s({},this.props,{expression:this.state.expression,onChange:this.onExpChange,autoFocus:!0}))))},t.count=0,t}(i.React.PureComponent);t.default=c},732:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),i=n(3),a=n(149),p=function(e){function t(t){var n=e.call(this,t)||this;n.dsManager=s.DataSourceManager.getInstance(),n.getWhetherExpressionIsFuncAndHasOnePart=function(e){return!!e&&!(1!==e.length||!e[0]||e[0].type!==s.ExpressionPartType.Function)},n.hasNoParamAndDsEnabled=function(e){return!!e&&((!e.parts||0===e.parts.length)&&a.getWhetherUseDssMatchExpDss(e,n.props.dataSourceIds.asMutable()))},n.hasOneParamAndDsEnabled=function(e){return!!e&&(e.parts&&1===e.parts.length&&a.getWhetherUseDssMatchExpDss(e.parts[0],n.props.dataSourceIds.asMutable()))},n.getWhetherUseSelectedDs=function(e){return!n.state||!n.state.selectedDsId||e.dataSourceId===n.state.selectedDsId},n.getDefaultDsId=function(){var e=n.props.expression&&n.props.expression.parts,t=s.groupExpressionPartsByFunction(e);if(n.getWhetherExpressionIsFuncAndHasOnePart(t)){var r=t[0];if(n.hasNoParamAndDsEnabled(r))return r.dataSourceId||n.props.dataSourceIds&&n.props.dataSourceIds[0];if(n.hasOneParamAndDsEnabled(r))return r.parts[0].dataSourceId||n.props.dataSourceIds&&n.props.dataSourceIds[0]}return n.props.dataSourceIds&&n.props.dataSourceIds[0]},n.getDefaultFunc=function(){var e=n.props.expression&&n.props.expression.parts,t=s.groupExpressionPartsByFunction(e);return n.getWhetherExpressionIsFuncAndHasOnePart(t)&&t[0].exp||s.ExpressionFunctions.Average},n.getDefaultJimuName=function(e){var t=n.props.expression&&n.props.expression.parts,r=s.groupExpressionPartsByFunction(t),o=r[0];return n.getWhetherExpressionIsFuncAndHasOnePart(r)&&n.hasOneParamAndDsEnabled(o)&&n.getWhetherUseSelectedDs(o.parts[0])&&o.parts[0].jimuFieldName||e&&Object.keys(e)[0]},n.getDataSourceId=function(){return n.state.selectedDsId},n.getSelectedFieldName=function(e,t){return e?t&&e[t]&&(e[t].alias||e[t].name):""},n.getSelectedJimuFieldName=function(){return n.state.selectedJimuFieldName},n.getSelectedFunction=function(){return n.state.selectedFunction},n.getNumberFields=function(e){if(!e)return{};var t=n.dsManager&&n.dsManager.getDataSource(e),r=t&&t.getSchema(),o=r&&r.fields;if(!o)return{};var i={};return Object.keys(o).forEach((function(e){o[e].type===s.JimuFieldType.Number&&(i[e]=o[e])})),i},n.getDsLabel=function(e){var t=n.dsManager&&n.dsManager.getDataSource(e);return t?t.label||t.id:e},n.onDsChange=function(e){var t=e.currentTarget.value;n.setState({selectedDsId:t})},n.onFieldChange=function(e){var t=e.currentTarget.value;n.setState({selectedJimuFieldName:t})},n.onFunctionChange=function(e){var t=e.currentTarget.value;n.setState({selectedFunction:t})},n.onChange=function(){var e=n.getNumberFields(n.state.selectedDsId),t=n.getSelectedFieldName(e,n.state.selectedJimuFieldName),r=n.state.selectedFunction===s.ExpressionFunctions.Count?n.state.selectedFunction+"()":n.state.selectedFunction+"({"+t+"})",o=[{type:s.ExpressionPartType.Function,exp:n.state.selectedFunction}];n.state.selectedFunction===s.ExpressionFunctions.Count?(o[0].dataSourceId=n.state.selectedDsId,o=o.concat([{type:s.ExpressionPartType.Operator,exp:"("},{type:s.ExpressionPartType.Operator,exp:")"}])):o=o.concat([{type:s.ExpressionPartType.Operator,exp:"("},{type:s.ExpressionPartType.Field,exp:"{"+t+"}",dataSourceId:n.state.selectedDsId,jimuFieldName:n.state.selectedJimuFieldName},{type:s.ExpressionPartType.Operator,exp:")"}]),n.props.onChange({name:r,parts:o})};var r=n.getDefaultDsId(),o=n.getNumberFields(r),i=n.getDefaultJimuName(o),p=n.getDefaultFunc();return n.state={selectedDsId:r,selectedJimuFieldName:i,selectedFunction:p},n}return o(t,e),t.prototype.componentDidUpdate=function(e,t){if(e.expression!==this.props.expression){var n=this.getDefaultDsId(),r=this.getNumberFields(n),o=this.getDefaultJimuName(r),s=this.getDefaultFunc();this.setState({selectedDsId:n,selectedJimuFieldName:o,selectedFunction:s})}if(t.selectedDsId!==this.state.selectedDsId){r=this.getNumberFields(this.state.selectedDsId),o=this.getDefaultJimuName(r);this.setState({selectedJimuFieldName:o})}},t.prototype.render=function(){var e=this,t=this.getNumberFields(this.state.selectedDsId);return s.React.createElement("div",{className:"expression-builder-tab statistics-tab"},s.React.createElement("div",{className:"statistics-option mb-12"},s.React.createElement("div",{className:"w-100 text-truncate mb-12 option-label"},this.props.intl.formatMessage({id:"data",defaultMessage:i.defaultMessages.data})),s.React.createElement("div",{className:"flex-grow-1"},s.React.createElement(i.Select,{value:this.getDataSourceId(),className:"select-max-width text-truncate",onChange:this.onDsChange},this.props.dataSourceIds&&this.props.dataSourceIds.asMutable().map((function(t,n){return s.React.createElement("option",{value:t,key:n,className:"select-max-width text-truncate"},e.getDsLabel(t))}))))),s.React.createElement("div",{className:"statistics-option mb-12"},s.React.createElement("div",{className:"w-100 text-truncate mb-12 option-label"},this.props.intl.formatMessage({id:"operator",defaultMessage:i.defaultMessages.operator})),s.React.createElement("div",{className:"flex-grow-1"},s.React.createElement(i.Select,{value:this.getSelectedFunction(),className:"select-max-width text-truncate",onChange:this.onFunctionChange},Object.keys(s.ExpressionFunctions).map((function(e,t){return s.React.createElement("option",{value:s.ExpressionFunctions[e],key:t,className:"select-max-width text-truncate"},s.ExpressionFunctions[e])}))))),this.state.selectedFunction&&this.state.selectedFunction!==s.ExpressionFunctions.Count&&s.React.createElement("div",{className:"statistics-option mb-12"},s.React.createElement("div",{className:"w-100 text-truncate mb-12 option-label"},this.props.intl.formatMessage({id:"field",defaultMessage:i.defaultMessages.field})),s.React.createElement("div",{className:"flex-grow-1"},s.React.createElement(i.Select,{value:this.getSelectedJimuFieldName(),onChange:this.onFieldChange,className:"select-max-width text-truncate"},t&&Object.keys(t).map((function(e,n){return s.React.createElement("option",{value:t[e].jimuName,key:n,className:"select-max-width text-truncate"},t[e].alias||t[e].name)}))))),s.React.createElement("div",{className:"mt-2 float-right expression-insert-btn"},s.React.createElement(i.Button,{onClick:this.onChange,type:"primary"},s.React.createElement("div",{className:"text-truncate"},this.props.intl.formatMessage({id:"insert",defaultMessage:i.defaultMessages.insert})))))},t}(s.React.PureComponent);t.default=p},733:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(3),p=n(149),c=n(150),l=n(430),u=n(150),d=n(321),f=n(322),h=n(323),x=n(324),g=function(e){function t(t){var n=e.call(this,t)||this;return n.toggleDropdown=function(){return n.setState({isDropdownOpen:!n.state.isDropdownOpen})},n.getExpFromIcon=function(e){switch(e){case u.ExpressionInputFrom.Static:return d;case u.ExpressionInputFrom.Attribute:return x;case u.ExpressionInputFrom.Statistics:return f;case u.ExpressionInputFrom.Expression:return h;default:return null}},n.getSelectedExpFromExpression=function(){if(!n.props.expression||!n.props.expression.parts||0===n.props.expression.parts.length)return n.props.from.some((function(e){return e===u.ExpressionInputFrom.Static}))?u.ExpressionInputFrom.Static:n.props.from.some((function(e){return e===u.ExpressionInputFrom.Attribute}))?u.ExpressionInputFrom.Attribute:n.props.from.some((function(e){return e===u.ExpressionInputFrom.Statistics}))?u.ExpressionInputFrom.Statistics:n.props.from.some((function(e){return e===u.ExpressionInputFrom.Expression}))?u.ExpressionInputFrom.Expression:null;var e=i.groupExpressionPartsByFunction(n.props.expression.parts);return 1===e.length&&e[0].type===i.ExpressionPartType.Field?n.props.from.some((function(e){return e===u.ExpressionInputFrom.Attribute}))?u.ExpressionInputFrom.Attribute:n.props.from.some((function(e){return e===u.ExpressionInputFrom.Expression}))?u.ExpressionInputFrom.Expression:null:1===e.length&&e[0].type===i.ExpressionPartType.Function?n.props.from.some((function(e){return e===u.ExpressionInputFrom.Statistics}))?u.ExpressionInputFrom.Statistics:n.props.from.some((function(e){return e===u.ExpressionInputFrom.Expression}))?u.ExpressionInputFrom.Expression:null:1===e.length&&e[0].type===i.ExpressionPartType.String&&n.props.from.some((function(e){return e===u.ExpressionInputFrom.Static}))?u.ExpressionInputFrom.Static:n.props.from.some((function(e){return e===u.ExpressionInputFrom.Expression}))?u.ExpressionInputFrom.Expression:null},n.getWhetherFromExpBuilder=function(e){return e&&Object.keys(c.ExpressionFrom).some((function(t){return c.ExpressionFrom[t]===e}))},n.getExpressionFrom=function(){return n.getWhetherFromExpBuilder(n.state.selectedExpFrom)?[n.state.selectedExpFrom]:[]},n.getStringFromExpression=function(){return n.props.expression&&1===n.props.expression.parts.length&&n.props.expression.parts[0].type===i.ExpressionPartType.String?n.props.expression.parts[0].exp.replace(/^"/,"").replace(/"$/,""):""},n.onInputBlur=function(e){var t=e.target.value,r={name:t,parts:[{type:i.ExpressionPartType.String,exp:'"'+t+'"'}]};n.props.onChange&&n.props.onChange(r)},n.onInputChange=function(e){n.setState({inputValue:e.target.value})},n.onExpChange=function(e){n.props.onChange&&n.props.onChange(e)},n.onExpFromChange=function(e){e!==n.state.selectedExpFrom?(n.onExpChange({name:"",parts:[]}),n.setState({selectedExpFrom:e})):n.toggleExpPopup()},n.getWhetherExpDssMatchInUseDss=function(e){var t=e&&e.parts;return!!t&&t.every((function(e){return p.getWhetherUseDssMatchExpDss(e,n.props.dataSourceIds.asMutable())}))},n.toggleExpPopup=function(){n.getWhetherFromExpBuilder(n.state.selectedExpFrom)?n.props.isExpPopupOpen?n.props.closeExpPopup():n.props.openExpPopup():n.props.closeExpPopup()},n.state={selectedExpFrom:n.getSelectedExpFromExpression(),isDropdownOpen:!1,inputValue:n.getStringFromExpression()},n}return o(t,e),t.prototype.componentDidUpdate=function(e,t){t.selectedExpFrom!==this.state.selectedExpFrom&&this.toggleExpPopup()},t.prototype.render=function(){var e,t=this,n=this.getWhetherFromExpBuilder(this.state.selectedExpFrom),r=n?this.props.expression&&this.props.expression.name||"":this.state.inputValue,o=i.expressionUtils.getWhetherExpressionValid(this.props.expression),c=this.getWhetherExpDssMatchInUseDss(this.props.expression),u=!o||!c,d=this.props.placeHolders,f=void 0===d?{}:d,h=this.state.selectedExpFrom;return i.jsx("div",{style:this.props.style,className:i.classNames("w-100 h-100",(e={},e[this.props.className]=!!this.props.className,e))},i.jsx("div",{className:"d-flex justify-content-start align-items-center component-expression-input"},i.jsx("div",{className:"expression-builder-trigger"},i.jsx(a.Dropdown,{isOpen:this.state.isDropdownOpen,toggle:this.toggleDropdown,className:"w-100 h-100 expression-builder-trigger-dropdown"},i.jsx(a.DropdownButton,{arrow:!1,title:p.getExpressionFromString(this.state.selectedExpFrom,this.props.intl),className:"text-truncate d-flex justify-content-center align-items-center trigger-dropdown-toggle p-0"},h&&i.jsx(a.Icon,{icon:this.getExpFromIcon(h),className:"m-0 p-0"})),i.jsx(a.DropdownMenu,{zIndex:"3"},this.props.from.map((function(e,n){return i.jsx(a.DropdownItem,{onClick:function(n){return t.onExpFromChange(e)},key:n,className:"text-dark"},i.jsx(a.Icon,{icon:t.getExpFromIcon(e),className:"mr-2"}),i.jsx("span",null,p.getExpressionFromString(e,t.props.intl)))}))))),i.jsx("div",{className:"flex-grow-1 expression-input"},u&&n?r?i.jsx("div",{className:"w-100 h-100 text-truncate ds-disabled d-flex align-items-center",onClick:this.toggleExpPopup},i.jsx("span",{title:r},r)):i.jsx("div",{className:"w-100 h-100 text-truncate ds-disabled ds-placeholder d-flex align-items-center",onClick:this.toggleExpPopup},i.jsx("span",{title:f[h]},f[h])):i.jsx("div",{className:"w-100 h-100",onClick:n?this.toggleExpPopup:void 0},i.jsx("div",{className:"w-100 h-100"},i.jsx(a.TextInput,{className:i.classNames("w-100 h-100",{"ds-disabled":n}),value:r,disabled:n,onChange:this.onInputChange,onBlur:this.onInputBlur,title:r,placeholder:f[h]}),n&&i.jsx("div",{className:"ds-disabled disabled-input-cover"}))))),this.props.isExpPopupOpen?i.jsx(l.default,s({},this.props,{onChange:this.onExpChange,from:this.getExpressionFrom(),isOpen:this.props.isExpPopupOpen,onClose:this.props.closeExpPopup,autoFocus:!0})):null)},t}(i.React.PureComponent),m=i.themeUtils.withStyles(i.injectIntl(g),"ExpressionInput");t.default=m}})}));