define(["jimu-core","jimu-arcgis","jimu-ui/setting-components","jimu-ui/data-source-selector"],(function(e,t,o,n){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,o),a.l=!0,a.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=233)}({11:function(e,t){e.exports=n},233:function(e,t,o){"use strict";var n,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var i,s=o(3),u=o(7),c=o(5),p=o(11),l=o(36),d=s.Immutable([p.AllDataSourceTypes.FeatureLayer,p.AllDataSourceTypes.FeatureQuery]),m=function(e){function t(t){var o=e.call(this,t)||this;return o.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},o.getInitConfig=function(){return{useDataSource:o.props.config.useDataSource?o.checkAndGetInitUseDataSource(o.props.messageWidgetId,o.props.config.useDataSource):null}},o.checkAndGetInitUseDataSource=function(e,t){var o=s.getAppStore().getState().appStateInBuilder.appConfig,n=o.widgets[e],a=null,r=!1,i=n.useDataSources&&n.useDataSources[0]&&n.useDataSources[0].dataSourceId;if(!i)return null;var u=o.dataSources[i];if(!u||u.type!==c.ArcGISDataSourceTypes.WebMap&&u.type!==c.ArcGISDataSourceTypes.WebScene||(r=!0),r){var p=!1;if(n&&n.useDataSources)for(var l=0;l<n.useDataSources.length;l++)if(n.useDataSources[l].dataSourceId===t.rootDataSourceId){p=!0;break}a=p?t:null}else a=null;return a},o.handleTriggerLayerSelected=function(e,t){var n={dataSourceId:t.dataSourceJson.id,rootDataSourceId:t.rootDataSourceId};o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("useDataSource",n)})},o.handleRemoveLayerForTriggerLayer=function(){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("useDataSource",null)})},o.getDsRootIdsByWidgetId=function(e){var t,o,n,a,r,i,u=null===(a=null===(n=null===(o=null===(t=s.getAppStore().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appConfig)||void 0===n?void 0:n.widgets)||void 0===a?void 0:a[e],p=[],l=s.DataSourceManager.getInstance();return null===(i=null===(r=u)||void 0===r?void 0:r.useDataSources)||void 0===i||i.forEach((function(e){var t,o,n=l.getDataSource(e.dataSourceId);(null===(t=n)||void 0===t?void 0:t.type)!==c.ArcGISDataSourceTypes.WebMap&&(null===(o=n)||void 0===o?void 0:o.type)!==c.ArcGISDataSourceTypes.WebScene||p.push(e.dataSourceId)})),p.length>0?s.Immutable(p):void 0},o.getDsIdsByWidgetId=function(e){var t,o,n,a,r,i,u,c=null===(a=null===(n=null===(o=null===(t=s.getAppStore().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appConfig)||void 0===n?void 0:n.widgets)||void 0===a?void 0:a[e];return s.Immutable(null!=(u=null===(i=null===(r=c)||void 0===r?void 0:r.useDataSources)||void 0===i?void 0:i.map((function(e){return e.dataSourceId})))?u:[])},o.modalStyle.borderRight="1px solid black",o.modalStyle.borderBottom="1px solid black",o.state={isShowLayerList:!1},o}return a(t,e),t.prototype.componentDidMount=function(){var e=this.getInitConfig();this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("useDataSource",e.useDataSource)})},t.prototype.getStyle=function(e){return s.css(i||(i=r(["\n      .setting-header {\n        padding: "," "," "," ","\n      }\n\n      .deleteIcon {\n        cursor: pointer;\n        opacity: .8;\n      }\n\n      .deleteIcon:hover {\n        opacity: 1;\n      }\n    "],["\n      .setting-header {\n        padding: "," "," "," ","\n      }\n\n      .deleteIcon {\n        cursor: pointer;\n        opacity: .8;\n      }\n\n      .deleteIcon:hover {\n        opacity: 1;\n      }\n    "])),s.polished.rem(10),s.polished.rem(16),s.polished.rem(0),s.polished.rem(16))},t.prototype.render=function(){var e=this.getDsRootIdsByWidgetId(this.props.messageWidgetId);return s.jsx("div",{css:this.getStyle(this.props.theme)},s.jsx(u.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:l.default.mapAction_TriggerLayer})},s.jsx(p.DataSourceSelector,{types:d,selectedDataSourceIds:this.props.config.useDataSource&&this.props.config.useDataSource.dataSourceId?s.Immutable([this.props.config.useDataSource.dataSourceId]):s.Immutable([]),fromRootDsIds:e,fromDsIds:e?void 0:this.getDsIdsByWidgetId(this.props.messageWidgetId),closeDataSourceListOnSelect:!0,hideAddData:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onSelect:this.handleTriggerLayerSelected,onRemove:this.handleRemoveLayerForTriggerLayer})))},t.defaultProps={config:s.Immutable({useDataSource:null})},t}(s.React.PureComponent);t.default=s.themeUtils.withTheme(m)},3:function(t,o){t.exports=e},36:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={sourceLabel:"Source",sourceDescript:"A web map or web scene, or any combination of the two.",initialMap:"Initial map",initialMapView:"Initial view",selectMap:"Select map",setMapView:"Set map view",initialMapViewContent:"The initial position of the map inherited from the web map or web scene.",respectsTheSource:"Respects the source",usesCustomView:"Uses custom view",customViewSet:"Set",toolLabel:"Tools",options:"Options",disableScrollZoom:"Disable scroll zooming",disablePopUp:"Disable pop-up",chooseALayer:"Select a layer",dataRelationShip:"Data relationship",mapNone:"none",messageField:"Message field",mapLayout:"Tools layout",mapLayout_LargeAndMedium:"Large and medium size",mapLayout_Small:"Small size",mapAction_TriggerLayer:"Trigger layer",mapAction_SetData:"Select layer",mapAction_ActionLayer:"Action layer",mapAction_Conditions:"Conditions",mapAction_RelateMessage:"Trigger / action connection",mapAction_TriggerLayerField:"Select a trigger field",mapAction_None:"none",mapAction_Equals:"equals",mapAction_ActionLayerField:"Select an action field",mapAction_MoreConditions:"More conditions",mapAction_SetExpression:"Please set your expression first.",mapAction_ChooseLayer:"Select layer",mapAction_AutoBind:"Auto bound.",mapAction_NoLayer:"No layer.",mapZoomToAction_ZoomScale:"Zoom scale",mapZoomToAction_Automatic:"Automatic",mapZoomToAction_Custom:"Custom",mapZoomToAction_TypeScale:"Type a scale"}},5:function(e,o){e.exports=t},7:function(e,t){e.exports=o}})}));