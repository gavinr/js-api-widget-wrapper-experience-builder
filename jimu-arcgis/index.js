define(["jimu-core","jimu-arcgis/arcgis-data-source"],(function(e,t){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(i,a,function(t){return e[t]}.bind(null,a));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=17)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Map="MAP",e.WebMap="WEB_MAP",e.WebScene="WEB_SCENE",e.FeatureLayer="FEATURE_LAYER"}(t.DataSourceTypes||(t.DataSourceTypes={})),t.fixLayerId=function(e){return e.replace(/\s/g,"_")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a,n,o,s=r(0);function u(e){var t=n.findOAuthInfo(e);if(!t){var r=s.getAppStore().getState().clientId,i=s.urlUtils.normalize(""+window.location.origin+s.urlUtils.getFolder(s.moduleLoader.resolveModuleFullPath("jimu-arcgis"))+"/oauth-callback.html");t=new a({appId:r,expiration:20159,portalUrl:e,authNamespace:"/",popup:!0,popupCallbackUrl:i}),n.registerOAuthInfos([t])}}function c(e){var t=s.SessionManager.getInstance();n.destroyCredentials(),e&&e.forEach((function(e){var r,i=e.toCredential(),a=t.getPortalInfo(e.portal);n.registerToken(i),!(i=n.findCredential(i.server))||n.findOAuthInfo(i.server)||(null===(r=a)||void 0===r?void 0:r.isMainPortal)||(i.scope="server"),a.isWebTier&&o.request.trustedServers.push(i.server)}))}function p(e,t){t!==s.SessionChangedReasonType.ArcGISJSSync&&c(e)}t.loadArcGISJSAPIModules=function(e){return s.loadDependency("jimu-arcgis").then((function(){return i||(i=s.moduleLoader.loadModules(["esri/identity/IdentityManager","esri/identity/OAuthInfo","esri/config"]).then((function(e){var t;n=e[0],a=e[1],o=e[2],n.useSignInPage=!1;var r=s.SessionManager.getInstance(),i=s.getAppStore().getState().portalUrl;(null===(t=r.getPortalInfo(i))||void 0===t?void 0:t.isWebTier)||u(i),u("https://devext.arcgis.com"),u("https://qaext.arcgis.com"),u("https://www.arcgis.com"),r.initFromCookie(),c(r.getSessions()),r.addSessionChangeListener(p),n.on("credential-create",(function(e){var t=e.credential;s.SessionManager.getInstance().addFromArcGisJSCredential(t)}))})).then((function(){return s.moduleLoader.loadModules(["dojo/promise/Promise","esri/config"])})).then((function(e){var t=e[0];e[1].request.proxyUrl=s.portalUrlUtils.getPortalProxyUrl(s.getAppStore().getState().portalUrl),t.prototype.toPromise=function(){var e=this;return new Promise((function(t,r){e.then((function(e){t(e)})).catch((function(e){r(e)}))}))}}))),i.then((function(){return s.moduleLoader.loadModules(e)}))}))}},function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(2),s=r(1),u=function(e){function t(t){var r=e.call(this,t)||this;return r.type=s.DataSourceTypes.Map,r.isDataSourceSet=!0,r.map=t.map,r}return a(t,e),t.prototype.ready=function(){var e=this;return o.loadArcGISJSAPIModules(["esri/Map","esri/layers/FeatureLayer"]).then((function(t){return e.Map=t[0],e.FeatureLayer=t[1],e.map||e.createMap(),e.createChildDataSources(),e.whenChildDataSourcesCreated()}))},t.prototype.fetchSchema=function(){var e=this.getChildDataSources(),t=n.Immutable({childSchemas:{}});return e.map((function(r,i){var a=r.getFetchedSchema();t=t.setIn(["childSchemas",s.fixLayerId(e[i].layer.id)],a)})),Promise.resolve(t)},t.prototype.whenChildDataSourcesCreated=function(){return this.childDataSourcesPromise.then((function(e){return e}))},t.prototype.createMap=function(){var e=this;this.map=new this.Map,this.dataSourceJson.layers.forEach((function(t){e.map.layers.add(new e.FeatureLayer(t))}))},t.prototype.createChildDataSources=function(){var e=this,t=[];return this.map.layers.toArray().forEach((function(r){e.getJimuChildId(s.fixLayerId(r.id)).forEach((function(i){var a=e.dataSourceJson.schema?e.dataSourceJson.schema.childSchemas[i]:null,o=n.Immutable({id:e.getFullChildDataSourceId(i),type:s.DataSourceTypes.FeatureLayer,label:r.title});if(a&&(o=o.set("schema",a)),"feature"===r.type&&r.url){var u={dataSourceJson:o,layer:r,parentDataSource:e};t.push(e.dataSourceManager.createDataSource(u))}}))})),this.childDataSourcesPromise=Promise.all(t),this.childDataSourcesPromise},t.prototype.destroy=function(){var e=this;this.getChildDataSources().forEach((function(t){t&&e.dataSourceManager.destroyDataSource(t.id)}))},t}(n.AbstractDataSource);t.MapDataSource=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);t.ArcGISDataSourceTypes=i.DataSourceTypes,t.DataSourceTypes=i.DataSourceTypes;var a=r(3);t.MapDataSource=a.MapDataSource;var n=r(8);t.WebMapDataSource=n.WebMapDataSource;var o=r(9);t.WebSceneDataSource=o.WebSceneDataSource;var s=r(10);t.FeatureLayerDataSource=s.FeatureLayerDataSource;var u=r(5);t.FeatureDataRecord=u.FeatureDataRecord;var c=function(){function e(){}return e.prototype.createDataSource=function(e){var t=e.dataSourceJson;return t.type===i.DataSourceTypes.Map?new a.MapDataSource(e):t.type===i.DataSourceTypes.WebMap?new n.WebMapDataSource(e):t.type===i.DataSourceTypes.WebScene?new o.WebSceneDataSource(e):t.type===i.DataSourceTypes.FeatureLayer?new s.FeatureLayerDataSource(e):void console.error("Unimplemented data source type.",t.type)},e}();t.ArcGISDataSourceFactory=c},function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(e){function t(t,r,i){void 0===i&&(i=!0);var a=e.call(this)||this;return a.dataSource=r,i?(t.attributes=a.convertBeforeMappingDataToData(t.attributes),a.feature=t):a.feature=t,a}return a(t,e),t.prototype.getData=function(){return this.feature.attributes},t.prototype.getFormattedFieldValue=function(t,r){var i=this.dataSource.getLayerDefinition(),a=n.dataSourceUtils.getDisplayValueForCodedValueOrSubtype(i,t,this.getData());return a.isCodedValueOrSubtype?a.displayValue:e.prototype.getFormattedFieldValue.call(this,t,r)},t.prototype.getDataBeforeMapping=function(){var e=this.feature.clone();return e.attributes=this.convertDataToDataBeforeMapping(this.getData()),e},t.prototype.toJson=function(){return this.feature.toJSON()},t.prototype.getId=function(){return this.feature.attributes[this.dataSource.getIdField()]+""},t.prototype.setId=function(e){},t.prototype.getGeometry=function(){return this.feature.geometry.toJSON()},t}(n.AbstractDataRecord);t.FeatureDataRecord=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),a=r(16),n=function(){function e(){this.jimuMapViews={}}return e.prototype.addJimuMapView=function(e){this.jimuMapViews[e.id]=e},e.prototype.setJimuMapView=function(e){this.jimuMapViews[e.id]=e},e.prototype.removeJimuMapView=function(e){delete this.jimuMapViews[e.id]},e.prototype.getActiveJimuMapView=function(){for(var e=Object.keys(this.jimuMapViews),t=0;t<e.length;t++)if(this.jimuMapViews[e[t]].isActive)return this.jimuMapViews[e[t]];return null},e}();t.JimuMapViewGroup=n;var o=function(){function e(){this.jimuMapViewGroups={}}return e.getInstance=function(){return window.jimuConfig.isBuilder?window._appWindow&&window._appWindow._mapViewManager:(e._instance||(e._instance=new e,window._mapViewManager=e._instance),e._instance)},e.prototype.getJimuMapViewById=function(e){var t=Object.keys(this.jimuMapViewGroups);if(0===t.length)return null;for(var r=0;r<t.length;r++){var i=t[r];if(Object.keys(this.jimuMapViewGroups[i].jimuMapViews).indexOf(e)>-1)return this.jimuMapViewGroups[i].jimuMapViews[e]}return null},e.prototype.getJimuMapViewGroup=function(e){return this.jimuMapViewGroups[e]?this.jimuMapViewGroups[e]:null},e.prototype.createJimuMapView=function(e){var t=e.mapWidgetId+"-"+e.datasourceId;if(this.getJimuMapViewById(t))return Promise.resolve(this.getJimuMapViewById(t));var r=new a.JimuMapView(e);return this.addJimuMapView(r),r.whenJimuMapViewLoaded()},e.prototype.addJimuMapView=function(e){if(this.jimuMapViewGroups[e.mapWidgetId])this.jimuMapViewGroups[e.mapWidgetId].addJimuMapView(e);else{var t=new n;t.addJimuMapView(e),this.jimuMapViewGroups[e.mapWidgetId]=t}i.getAppStore().dispatch(i.appActions.jimuMapViewAdded(e.id,i.Immutable({id:e.id,mapWidgetId:e.mapWidgetId,datasourceId:e.datasourceId,status:e.status})))},e.prototype.setJimuMapView=function(e){if(this.jimuMapViewGroups[e.mapWidgetId])this.jimuMapViewGroups[e.mapWidgetId].setJimuMapView(e);else{var t=new n;t.addJimuMapView(e),this.jimuMapViewGroups[e.mapWidgetId]=t}i.getAppStore().dispatch(i.appActions.jimuMapViewUpdated(e.id,i.Immutable({id:e.id,mapWidgetId:e.mapWidgetId,datasourceId:e.datasourceId,isActive:e.isActive,status:e.status})))},e.prototype.destroyJimuMapView=function(e){var t=this.getJimuMapViewById(e);t&&t.destroy();var r=Object.keys(this.jimuMapViewGroups);if(0!==r.length)for(var a=0;a<r.length;a++){var n=r[a];if(Object.keys(this.jimuMapViewGroups[n].jimuMapViews).indexOf(e)>-1){delete this.jimuMapViewGroups[n].jimuMapViews[e],0===Object.keys(this.jimuMapViewGroups[n].jimuMapViews).length&&delete this.jimuMapViewGroups[n],i.getAppStore().dispatch(i.appActions.jimuMapViewRemoved(e));break}}},e}();t.MapViewManager=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(4);t.default=i.ArcGISDataSourceFactory,function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(4))},function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),o=r(3),s=r(2),u=r(0),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=n.DataSourceTypes.WebMap,t}return a(t,e),t.prototype.ready=function(){var e=this;return s.loadArcGISJSAPIModules(["esri/WebMap","esri/portal/Portal","esri/portal/PortalItem"]).then((function(t){return e.WebMap=t[0],e.Portal=t[1],e.PortalItem=t[2],e.map||e.createMap(),e.createChildDataSources(),e.whenChildDataSourcesCreated()}))},t.prototype.createMap=function(){if(this.dataSourceJson.portalUrl){var e=new this.Portal({url:u.portalUrlUtils.getHostUrlByOrgUrl(this.dataSourceJson.portalUrl)});this.map=new this.WebMap({portalItem:new this.PortalItem({id:this.dataSourceJson.itemId,portal:e})})}else this.map=new this.WebMap({portalItem:new this.PortalItem({id:this.dataSourceJson.itemId})});this.map.isFulfilled()||this.map.load()},t.prototype.createChildDataSources=function(){var t=this;return this.childDataSourcesPromise=this.map.when((function(){return e.prototype.createChildDataSources.call(t)})).toPromise(),this.childDataSourcesPromise},t}(o.MapDataSource);t.WebMapDataSource=c},function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),o=r(1),s=r(3),u=r(0),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=o.DataSourceTypes.WebScene,t}return a(t,e),t.prototype.ready=function(){var e=this;return n.loadArcGISJSAPIModules(["esri/WebScene","esri/portal/Portal","esri/portal/PortalItem"]).then((function(t){return e.WebScene=t[0],e.Portal=t[1],e.PortalItem=t[2],e.map||e.createMap(),e.createChildDataSources(),e.whenChildDataSourcesCreated()}))},t.prototype.createMap=function(){if(this.dataSourceJson.portalUrl){var e=new this.Portal({url:u.portalUrlUtils.getHostUrlByOrgUrl(this.dataSourceJson.portalUrl)});this.map=new this.WebScene({portalItem:new this.PortalItem({id:this.dataSourceJson.itemId,portal:e})})}else this.map=new this.WebScene({portalItem:new this.PortalItem({id:this.dataSourceJson.itemId})});this.map.isFulfilled()||this.map.load()},t.prototype.createChildDataSources=function(){var t=this;return this.childDataSourcesPromise=this.map.when((function(){return e.prototype.createChildDataSources.call(t)})).toPromise()},t}(s.MapDataSource);t.WebSceneDataSource=c},function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),s=r(2),u=r(1),c=r(11),p=r(5),d=function(e){function t(t){var r=e.call(this,t)||this;return r.jimuFeatureLayerViews={},r.layer=t.layer,r.url=t.layer.url,r}return a(t,e),t.prototype.ready=function(){var e=this;return s.loadArcGISJSAPIModules(["esri/layers/FeatureLayer"]).then((function(t){e.FeatureLayer=t[0]}))},t.prototype.doQuery=function(e){var t=this;if(e.outFields=e.outFields&&e.outFields.length>0?e.outFields:["*"],e.outFields&&"*"!==e.outFields[0]){var r=this.getLayerDefinition().typeIdField;r&&e.outFields.indexOf(r)<0&&e.outFields.push(r)}return this.layer.queryFeatures(e).then((function(r){var i=r.features.map((function(e){return new p.FeatureDataRecord(e,t)})),a=Object.keys(t.getSchema().fields).filter((function(e){return r.fields&&r.fields.find((function(r){return r.name===t.getSchema().fields[e].name}))}));return{queryParams:e,records:i,fields:a}})).toPromise()},t.prototype.doQueryCount=function(e){return this.layer.queryFeatureCount(e).toPromise().then((function(t){return{queryParams:e,count:t}}))},t.prototype.doQueryById=function(e){var t=this;return t.layer.queryFeatures({objectIds:[parseInt(e)],outFields:["*"],returnGeometry:!0}).then((function(e){return e.features.map((function(e){return new p.FeatureDataRecord(e,t)}))[0]})).toPromise()},t.prototype.mergeQueryParams=function(e,t){var r;return r=[e&&e.where,t&&t.where].filter((function(e){return e})).map((function(e){return""+e})).join(" and "),n(n(n({},e),t),{where:r})},t.prototype.getConfigQueryParams=function(){return this.dataSourceJson.query?{where:o.dataSourceUtils.getArcGISSQL(this.dataSourceJson.query.where,this).sql,orderByFields:this.getOrderBy(this.dataSourceJson.query.orderBy)}:null},t.prototype.getRealQueryParams=function(t,r,i){var a=e.prototype.getRealQueryParams.call(this,t,r,i);return this.getSchema().filter&&(a.where?a.where.indexOf(this.getSchema().filter)<0&&(a.where=a.where+" and "+this.getSchema().filter):a.where=this.getSchema().filter),a},t.prototype.getOrderBy=function(e){return e.map((function(e){return e.jimuFieldName+" "+e.order})).asMutable()},t.prototype.fetchSchema=function(){var e=this;return this.dataSourceJson.isStatistic?Promise.resolve(o.Immutable({})):this.layer.load().toPromise().then((function(){e._updateLayerDefinition();var t={fields:{},idField:e.layer.objectIdField,filter:e.layer.definitionExpression};return e.parentDataSource&&(t.childId=u.fixLayerId(e.layer.id),t.jimuChildId=u.fixLayerId(e.layer.id)),e.layer.fields.forEach((function(r){var i=e.layer.popupTemplate&&e.layer.popupTemplate.fieldInfos&&e.layer.popupTemplate.fieldInfos.find((function(e){return e.fieldName===r.name}));i&&(i=i.toJSON()),t.fields[r.name]=o.dataSourceUtils.convertFieldToJimuField(r.toJSON(),i)})),o.Immutable(t)}))},t.prototype._updateLayerDefinition=function(){var e=this.layer.sourceJSON,t=this.layer.renderer;if(t&&t.toJSON()){var r=t.toJSON();if("uniqueValue"===r.type){var i=this.layer.sourceJSON.types;r.field1!==this.layer.sourceJSON.typeIdField&&(i=[],r.uniqueValueInfos.map((function(e){i.push({id:e.value,name:e.label,domain:{}})}))),e=Object.assign({},e,{drawingInfo:{renderer:r},typeIdField:r.field1,types:i})}}this.layerDefinition=e},t.prototype.getLayerDefinition=function(){return this.layerDefinition},t.prototype.getFieldCodedValueList=function(e,t){var r="",i=this.getSchema().fields;return Object.keys(i).some((function(t){return t===e&&(r=i[t].name,!0)})),o.dataSourceUtils.getCodedValueListForCodedValueOrSubtypeField(this.getLayerDefinition(),r,t)},t.prototype.load=function(t){for(var r=this.jimuFeatureLayerViews,i=Object.keys(r),a=0;a<i.length;a++){r[i[a]].setDefinitionExpressionForLayer(this.getRealQueryParams(t,"load"))}return e.prototype.load.call(this,t)},t.prototype.selectRecordById=function(t){e.prototype.selectRecordById.call(this,t);for(var r=this.jimuFeatureLayerViews,i=Object.keys(r),a=0;a<i.length;a++){r[i[a]].highLightSelectedFeatures()}},t.prototype.selectRecordsByIds=function(t){e.prototype.selectRecordsByIds.call(this,t);for(var r=this.jimuFeatureLayerViews,i=Object.keys(r),a=0;a<i.length;a++){if(t)r[i[a]].highLightSelectedFeatures()}},t.prototype.addJimuFeatureLayerView=function(e){this.jimuFeatureLayerViews[e.id]=e},t.prototype.removeJimuFeatureLayerView=function(e){delete this.jimuFeatureLayerViews[e.id]},t}(o.AbstractQueriableDataSource);t.FeatureLayerDataSource=d,o.utils.applyMixins(d,[c.LayerDataSource])},function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.getMapDataSource=function(){return this.getRootDataSource()},t}(r(0).AbstractDataSource);t.LayerDataSource=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BaseDynamicLayer="base-dynamic",e.BaseElevationLayer="base-elevation",e.BaseTileLayer="base-tile",e.BuildingSceneLayer="building-scene",e.CSVLayer="csv",e.ElevationLayer="elevation",e.FeatureLayer="feature",e.GeoJSONLayer="geojson",e.GeoRSSLayer="geo-rss",e.GraphicsLayer="graphics",e.GroupLayer="group",e.ImageryLayer="imagery",e.IntegratedMeshLayer="integrated-mesh",e.KMLLayer="kml",e.MapImageLayer="map-image",e.MapNotesLayer="map-notes",e.PointCloudLayer="point-cloud",e.SceneLayer="scene",e.TileLayer="tile",e.UnknownLayer="unknown",e.UnsupportedLayer="unsupported",e.VectorTileLayer="vector-tile",e.WMSLayer="wms",e.WMTSLayer="wmts",e.WebTileLayer="web-tile"}(t.LayerTypes||(t.LayerTypes={}));var i=function(){function e(e){this.id=e.jimuMapViewId+"-"+e.jimuLayerId,this.view=e.view,this.type=e.type,this.layerDataSourceId=e.layerDataSourceId,this.jimuMapViewId=e.jimuMapViewId,this.jimuLayerId=e.jimuLayerId}return e.prototype.selectRecordsByIds=function(e){},e.prototype.destroy=function(){},e}();t.JimuLayerView=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),a=r(7),n=function(){function e(){this.id="arcgis-dependency-define"}return e.prototype.getDependencyKey=function(){return"jimu-arcgis"},e.prototype.getResources=function(){var e=window.arcgisApiUrl;if(!i.getAppStore().getState().queryObject.apiurl||(e=i.getAppStore().getState().queryObject.apiurl,this.checkApiUrl(e)))return/\/$/.test(e)||(e+="/"),window.dojoConfig={baseUrl:i.urlUtils.getFixedRootPath(),parseOnLoad:!1,async:!0,tlmSiblingOfDojo:!1,has:{"esri-featurelayer-webgl":1,"dojo-sniff":0,"dojo-cdn":0},locale:window.locale},window.dojoConfig.packages=[{name:"dojo",location:e+"dojo"},{name:"dijit",location:e+"dijit"},{name:"dojox",location:e+"dojox"},{name:"dgrid",location:e+"dgrid"},{name:"esri",location:e+"esri"},{name:"moment",location:e+"moment"},{name:"whatwg-fetch",location:e+"whatwg-fetch",main:"dist/fetch.umd"}],/src\/$/.test(e)?window.dojoConfig.packages=window.dojoConfig.packages.concat([{name:"@dojo",location:e+"node_modules/@dojo"},{name:"tslib",location:e+"node_modules/tslib",main:"tslib"},{name:"cldrjs",location:e+"node_modules/cldrjs",main:"dist/cldr"},{name:"globalize",location:e+"node_modules/globalize",main:"dist/globalize"},{name:"maquette",location:e+"node_modules/maquette",main:"dist/maquette.umd"},{name:"maquette-jsx",location:e+"node_modules/maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"maquette-css-transitions",location:e+"node_modules/maquette-css-transitions",main:"dist/maquette-css-transitions.umd"}]):window.dojoConfig.packages=window.dojoConfig.packages.concat([{name:"@dojo",location:e+"@dojo"},{name:"tslib",location:e+"tslib",main:"tslib"},{name:"cldrjs",location:e+"cldrjs",main:"dist/cldr"},{name:"globalize",location:e+"globalize",main:"dist/globalize"},{name:"maquette",location:e+"maquette",main:"dist/maquette.umd"},{name:"maquette-jsx",location:e+"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"maquette-css-transitions",location:e+"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"}]),[{url:"jimu-arcgis",dependencies:[{url:e+"dojo/dojo.js"},{url:e+"esri/css/main.css"}]}];console.log("Bad apiurl.",e)},e.prototype.checkApiUrl=function(e){return"development"===window.env||(!/^\/\//.test(e)&&!/^https?:\/\//.test(e)||/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(e))},e}();t.ArcGISDependencyDefineExtension=n;var o=function(){function e(){this.id="arcgis-ds-factory"}return e.prototype.getFactoryUri=function(e){if(Object.keys(a.ArcGISDataSourceTypes).map((function(e){return a.ArcGISDataSourceTypes[e]})).indexOf(e)>-1)return"jimu-arcgis/arcgis-data-source"},e}();t.ArcGISDataSourceFactoryUriExtension=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),a=r(2);function n(e,t,r,a){var n=new r({url:i.getAppStore().getState().portalSelf.helperServices.geometry.url}),o=new a({geometries:e,outSpatialReference:t});return n.project(o).toPromise()}t.projectToSpatialReference=function(e,t){return e&&0!==e.length&&e[0]&&t.wkid!==e[0].spatialReference.wkid&&!t.equals(e[0].spatialReference)?a.loadArcGISJSAPIModules(["esri/tasks/GeometryService","esri/tasks/support/ProjectParameters","esri/geometry/projection"]).then((function(r){var i,a,o;if(i=r[0],a=r[1],(o=r[2]).isSupported()){if(o.isLoaded()){var s=function(e,t,r){return r.project(e,t)}(e,t,o);return Promise.resolve(s)}return o.load(),n(e,t,i,a).then((function(e){return Promise.resolve(e)}),(function(e){return console.error(e),Promise.reject(e)}))}return n(e,t,i,a).then((function(e){return Promise.resolve(e)}),(function(e){return console.error(e),Promise.reject(e)}))})):Promise.resolve(e)}},function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),s=r(12),u=r(6),c=function(e){function t(t){var r=e.call(this,t)||this;return r.features=[],r.isReservePopup=!1,r.getViewForMap().popup.watch("selectedFeature",(function(e){e&&(r.isReservePopup=!0,r.highLightFeatures(r.getSelectedRecordIds().map((function(e){return parseInt(e)}))))})),r.getSelectedRecordIds().length>0?r.moveFeatureToCenter(r.getSelectedRecordIds()[0]).then((function(){r.highLightSelectedFeatures()})):r.getLayerDataSource()&&r.getLayerDataSource().getSelectedRecordIds().length>0&&r.moveFeatureToCenter(r.getLayerDataSource().getSelectedRecordIds()[0]).then((function(){r.highLightFeatures(r.getLayerDataSource().getSelectedRecordIds().map((function(e){return parseInt(e)})))}),(function(e){return console.error(e)})),r}return a(t,e),t.prototype.doQuery=function(e){var t=this;return new Promise((function(r){t.view.updating?(t.updateWatchHandle&&(t.updateWatchHandle.remove(),t.updateWatchHandle=null),t.updateWatchHandle=t.view.watch("updating",(function(i){i||t.view.queryFeatures(e).then((function(e){t.features=e.features,r(t.features)}))}))):t.view.queryFeatures(e).then((function(e){t.features=e.features,r(t.features)}),(function(e){console.error(e)}))}))},t.prototype.doQueryById=function(e){var t={objectIds:[parseInt(e)],returnGeometry:!0};return this.doQuery(t).then((function(e){return e[0]}))},t.prototype.mergeQuery=function(e,t){var r="("+e.where+") and ("+t.where+")";return n(n(n({},e),t),{where:r})},t.prototype.setDefinitionExpressionForLayer=function(e){e&&(this.view.layer.definitionExpression=e.where)},t.prototype.highLightSelectedFeatures=function(){this.highLightFeatures(this.getSelectedRecordIds().map((function(e){return parseInt(e)})))},t.prototype.highLightFeatures=function(e){var t=this;this.highLightHandle&&(this.highLightHandle.remove(),this.highLightHandle=null,this.isReservePopup?this.isReservePopup=!1:this.getViewForMap().popup.close()),this.view.when((function(){t.highLightHandle=t.view.highlight(e)}))},t.prototype.clearHighLight=function(){this.highLightHandle&&(this.highLightHandle.remove(),this.highLightHandle=null,this.getViewForMap().popup.close())},t.prototype.selectRecordById=function(e){this.getLayerDataSource().selectRecordById(e),null==e&&this.clearHighLight()},t.prototype.selectRecordsByIds=function(e){this.getLayerDataSource().selectRecordsByIds(e),e&&e.length>0||this.clearHighLight()},t.prototype.getViewForMap=function(){var e=u.MapViewManager.getInstance().getJimuMapViewById(this.jimuMapViewId);return e&&e.view},t.prototype.handleFeatureNavigationAtPopUp=function(e){var t=this.getLayerDataSource();this.isReservePopup=!0,t.selectRecordsByIds([e])},t.prototype.moveFeatureToCenter=function(e){var t=this;return this.doQueryById(e).then((function(r){return r||(t.getLayerDataSource()?t.getLayerDataSource().doQueryById(e).then((function(e){return e&&e.feature})):null)})).then((function(r){if(r){var i=t.getCenterPoint(r.geometry);return i?t.getViewForMap().goTo(i):Promise.reject("Does not find center point.")}return Promise.reject("Dose not find feature."+e)}))},t.prototype.getCenterPoint=function(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return e.extent.center;default:return e&&e.extent?e.extent.center:void 0}},t.prototype.getSelectedRecordIds=function(){var e=this;return o.getAppStore().getState().dataSourcesInfo[this.layerDataSourceId]?o.getAppStore().getState().dataSourcesInfo[this.layerDataSourceId].selectedIds?o.getAppStore().getState().dataSourcesInfo[this.layerDataSourceId].selectedIds.asMutable():o.getAppStore().getState().dataSourcesInfo[this.layerDataSourceId].selectedIndexes?o.getAppStore().getState().dataSourcesInfo[this.layerDataSourceId].selectedIndexes.asMutable().map((function(t){return e.features[t].attributes[e.getIdField()]})):[]:[]},t.prototype.getIdField=function(){var e=this.view.layer.objectIdField;if(!e){var t=this.view.layer.fields.find((function(e){return"oid"===e.type}));t&&(e=t.name)}return e||(e="OBJECTID"),e},t.prototype.getLayerDataSource=function(){return o.DataSourceManager.getInstance().getDataSource(this.layerDataSourceId)},t.prototype.destroy=function(){var e=o.DataSourceManager.getInstance().getDataSource(this.layerDataSourceId);e&&e.removeJimuFeatureLayerView(this)},t}(s.JimuLayerView);t.JimuFeatureLayerView=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),a=r(12),n=r(15),o=r(6),s=r(1),u=function(){function e(e){var t=this;this.jimuLayerViewLoadPromises={},this.isClickedNoPopUpFeature=!1,this.isEnableHighlight=!0,this.getJimuLayerViewId=function(e,r){var a=i.DataSourceManager.getInstance().getDataSource(e).getJimuChildId(r)[0];return t.id+"-"+a},this.id=e.mapWidgetId+"-"+e.datasourceId,this.mapWidgetId=e.mapWidgetId,this.isActive=e.isActive,this.datasourceId=e.datasourceId,this.view=e.view,this.jimuLayerViews={},this.status=i.JimuMapViewStatus.Loading,this.isEnablePopup=void 0===e.isEnablePopup||null===e.isEnablePopup||e.isEnablePopup,this.isEditing=!1,this.initView(this.view)}return e.prototype.startEdit=function(){this.isEditing=!0},e.prototype.exitEdit=function(){this.isEditing=!1},e.prototype.getIsEditing=function(){return this.isEditing},e.prototype.enablePopup=function(){this.isEditing&&!this.isEnablePopup&&this.view&&this.view.popup&&(this.view.popup.autoOpenEnabled=!0,this.isEnablePopup=!0)},e.prototype.disablePopup=function(){this.isEditing&&this.isEnablePopup&&this.view&&this.view.popup&&(this.view.popup.autoOpenEnabled=!1,this.isEnablePopup=!1)},e.prototype.getIsEnablePopup=function(){return this.isEnablePopup},e.prototype.enableHighlight=function(){this.isEditing&&!this.isEnableHighlight&&(this.isEnableHighlight=!0)},e.prototype.disableHighlight=function(){this.isEditing&&this.isEnableHighlight&&(this.isEnableHighlight=!1)},e.prototype.getIsEnableHighlight=function(){return this.isEnableHighlight},e.prototype.setIsActive=function(e){this.isActive=e,o.MapViewManager.getInstance().setJimuMapView(this)},e.prototype.initView=function(e){var t=this;e&&(e.when((function(){e.on("click",t.onClick.bind(t))})),e.popup.watch("visible",(function(r){if(t.isEnablePopup&&(r?t.isClickedNoPopUpFeature=!1:i.MessageManager.getInstance().publishMessage(new i.DataRecordsSelectionChangeMessage(t.mapWidgetId,[])),!r&&e.popup.selectedFeature&&e.popup.selectedFeature.layer)){if(!e.popup.selectedFeature.layer.id)return;if(t.isClickedNoPopUpFeature)return void(t.isClickedNoPopUpFeature=!1);t.clearAllJimuLayerViewsSelectRecord()}})),e.popup.watch("selectedFeature",(function(e){if(e&&e.layer){var r=String(e.attributes[e.layer.objectIdField]);if(e.layer.id){var n=t.getJimuLayerViewId(t.datasourceId,s.fixLayerId(e.layer.id)),o=t.jimuLayerViews[n];if(o)switch(o.type){case a.LayerTypes.FeatureLayer:o.handleFeatureNavigationAtPopUp(r),o.getLayerDataSource().doQueryById(r).then((function(e){i.MessageManager.getInstance().publishMessage(new i.DataRecordsSelectionChangeMessage(t.mapWidgetId,[e]))}))}}}})))},e.prototype.onClick=function(e){var t=this,r={x:e.x,y:e.y};this.view.hitTest(r).then((function(e){if(t.isEnableHighlight&&(e&&e.results&&0!==e.results.length||(t.clearAllJimuLayerViewsSelectRecord(),i.MessageManager.getInstance().publishMessage(new i.DataRecordsSelectionChangeMessage(t.mapWidgetId,[]))),e.results.length)){var r=t.jimuLayerViews,n=Object.keys(r);if(e.results.forEach((function(e){var r=e.graphic;if(r&&r.layer){var o=r.layer.id;r.layer.popupEnabled||(t.isClickedNoPopUpFeature=!0);var s=t.getJimuLayerViewId(t.datasourceId,o),u=t.jimuLayerViews[s];if(u)switch(u.type){case a.LayerTypes.FeatureLayer:n.splice(n.indexOf(s),1);var c=String(r.attributes[r.layer.objectIdField]);u.selectRecordById(c),u.getLayerDataSource().doQueryById(c).then((function(e){i.MessageManager.getInstance().publishMessage(new i.DataRecordsSelectionChangeMessage(t.mapWidgetId,[e]))}))}}})),n)for(var o=0;o<n.length;o++){var s=t.jimuLayerViews[n[o]];if(s)switch(s.type){case a.LayerTypes.FeatureLayer:s.selectRecordsByIds([])}}}}),(function(){t.clearAllJimuLayerViewsSelectRecord()}))},e.prototype.clearAllJimuLayerViewsSelectRecord=function(){for(var e=this.jimuLayerViews,t=Object.keys(e),r=0;r<t.length;r++){e[t[r]].selectRecordsByIds([])}},e.prototype.createJimuLayerViews=function(){return this.whenAllJimuLayerViewsLoaded(this.view)},e.prototype.addJimuLayerView=function(e){this.jimuLayerViews[e.id]=e},e.prototype.whenJimuMapViewLoaded=function(){var e=this;return this.view?this.view.when().toPromise().then((function(){return e.createJimuLayerViews(),e.status=i.JimuMapViewStatus.Loaded,o.MapViewManager.getInstance().setJimuMapView(e),Promise.resolve(e)}),(function(t){return console.error(t),e.status=i.JimuMapViewStatus.Failed,o.MapViewManager.getInstance().setJimuMapView(e),Promise.reject(e)})):(this.status=i.JimuMapViewStatus.Failed,o.MapViewManager.getInstance().setJimuMapView(this),Promise.reject(this))},e.prototype.whenAllJimuLayerViewsLoaded=function(e){var t=this,r=[],o=this;return e.map.layers.toArray().map((function(u){var c=i.DataSourceManager.getInstance().getDataSource(t.datasourceId),p=c.getJimuChildId(s.fixLayerId(u.id))[0],d=c.getFullChildDataSourceId(p),l=e.whenLayerView(u).toPromise().then((function(e){var r=null,o=null;switch(u.type){case a.LayerTypes.FeatureLayer:r={jimuLayerId:p,layerDataSourceId:d,view:e,jimuMapViewId:t.id,type:u.type},o=new n.JimuFeatureLayerView(r),t.addJimuLayerView(o);var s=i.DataSourceManager.getInstance().getDataSource(o.layerDataSourceId);if(s){s.addJimuFeatureLayerView(o);var c=s.getCurrentQueryParams();o.setDefinitionExpressionForLayer(c)}break;default:r={jimuLayerId:p,layerDataSourceId:d,view:e,jimuMapViewId:t.id,type:u.type},o=new a.JimuLayerView(r),t.addJimuLayerView(o)}return Promise.resolve(o)}),(function(){return Promise.reject(null)}));r.push(l),o.jimuLayerViewLoadPromises[t.id+"-"+p]=l})),Promise.all(r)},e.prototype.getJimuLayerViewLoadPromiseById=function(e){return this.jimuLayerViewLoadPromises[e]},e.prototype.destroy=function(){for(var e=this.jimuLayerViews,t=Object.keys(e),r=0;r<t.length;r++){e[t[r]].destroy()}if(this.view&&!this.view.destroyed){this.view.graphics&&this.view.graphics.destroyed&&this.view.graphics.destroy(),this.view.container=null,this.view.allLayerViews&&this.view.allLayerViews.destroyed&&this.view.allLayerViews.destroy(),this.view.layerViews&&this.view.layerViews.destroyed&&this.view.layerViews.destroy();var i=this.view.ui;i.exbMapTools&&0!==Object.keys(i.exbMapTools).length&&Object.keys(i.exbMapTools).map((function(e,t){i.exbMapTools[e].destroy()})),i.exbMapTools={},this.view.destroy(),this.view=null}},e}();t.JimuMapView=u},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0});var a=r(14);t.geometryUtils=a;var n=r(18);t.zoomToUtils=n;var o=r(19);t.portalUtils=o;var s=r(20);t.defaultMessages=s.default,i(r(21)),i(r(6)),i(r(22)),i(r(13)),i(r(2));var u=r(23);t.JimuMapViewComponent=u.JimuMapViewComponent;var c=r(24);t.JimuLayerViewComponent=c.JimuLayerViewComponent;var p=r(25);t.init=p.init},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=r(2),n=r(14),o=null;function s(e,t,r,i,o){var s;if(i&&p(i)){if("3d"===e.type&&!o)return n.projectToSpatialReference([i],e.spatialReference).then((function(t){return e.goTo(t)}));s=Promise.resolve(i)}else if(r){if("3d"===e.type&&!o)return e.goTo(r);s=f(e,r)}else s=function(e,t){return"feature"===t.type?function(e,t){var r=t.fullExtent.clone();if(!t.url)return Promise.resolve(r);var i=t.capabilities.query;return i?a.loadArcGISJSAPIModules(["esri/tasks/support/Query"]).then((function(a){var n=new(0,a[0]);return n.where=t.definitionExpression?t.definitionExpression:"1=1",n.outSpatialReference=e.spatialReference,n.returnGeometry=!0,i.supportsExtent?t.queryExtent(n).then((function(e){return e.extent})).catch((function(e){return Promise.resolve(r)})):t.queryFeatures(n).then((function(t){return f(e,t.features)})).catch((function(e){return Promise.resolve(r)}))})).catch((function(e){return Promise.resolve(r)})):Promise.resolve(r)}(e,t):Promise.resolve(t.fullExtent.clone())}(e,t);return s.then((function(t){return n.projectToSpatialReference([t],e.spatialReference).then((function(e){return e&&e[0]}))})).then((function(r){if(!p(r))return Promise.reject(new Error("Invalid extent."));if(o)return r=w(e,r),v(e,r,o).then((function(t){c(e,t)}));var i=t.minScale||0,n=t.maxScale||0;if(!l(r))return r=function(e,t){var r=e.size[0]/e.size[1],i=t.width/t.height;if(i>r){var a=t.width/r/2;t.ymin=t.center.y-a,t.ymax=t.center.y+a}else if(i<r){var n=t.height*r/2;t.xmin=t.center.x-n,t.xmax=t.center.x+n}return t}(e,r),function(e,t){return a.loadArcGISJSAPIModules(["esri/config","esri/geometry/support/WKIDUnitConversion"]).then((function(r){var i,a;i=r[0],a=r[1];var n,o,s=e.size[0],u=a,c=t.spatialReference;c&&(n=c.wkid,o=c.wkt);var p=null;if(n)p=u.values[u[n]];else if(o&&-1!==o.search(/^PROJCS/i)){var d=/UNIT\[([^\]]+)\]\]$/i.exec(o);d&&d[1]&&(p=parseFloat(d[1].split(",")[1]))}return t.width/s*(p||20015077/180)*39.37*(i.screenDPI||96)})).catch((function(e){return Promise.reject()}))}(e,r).then((function(t){return i>0&&t>i?(i=g(e,i,!0),r=w(e,r),v(e,r,i).then((function(t){c(e,t)}))):t<n?(n=g(e,n,!1),r=w(e,r),v(e,r,n).then((function(t){c(e,t)}))):void c(e,r)}));var s=m(e,i,n,3);return s?("3d"===e.type&&4513.9887>s&&(s=0===i||4513.9887<i?4513.9887:i),r=w(e,r),v(e,r,s).then((function(t){c(e,t)}))):void 0})).catch((function(e){return Promise.reject(e)}))}function u(e,t,r){return p(t=t.clone())?n.projectToSpatialReference([t],e.spatialReference).then((function(r){var i=r&&r[0];return i||(i=t),l(i)?function(e,t){var r=m(e,0,0,3);return r?(t=w(e,t),v(e,t,r)):Promise.reject()}(e,i):i})).then((function(t){return r?v(e,t,r):t})).then((function(t){c(e,t)})).catch((function(e){return Promise.reject(e)})):Promise.reject(new Error("Invalid extent."))}function c(e,t){return e.goTo(t)}function p(e){return e&&d(e.xmin)&&d(e.ymin)&&d(e.xmax)&&d(e.ymax)}function d(e){return 0===e||!!e}function l(e){return e.xmin+i.X===e.xmax-i.X&&e.ymin+i.Y===e.ymax-i.Y}function f(e,t,r){void 0===r&&(r={});var i=t&&t[0]&&t[0].layer;return i&&"scene"===i.type?function(e,t,r){return a.loadArcGISJSAPIModules(["esri/tasks/support/Query"]).then((function(r){var i=r[0];if(t){var a=new i;return a.objectIds=e.map((function(e){return e.attributes[t.objectIdField]})),a.returnGeometry=!0,t.queryExtent(a).then((function(e){return 1===e.count?e.extent.expand(3.5):e.extent.expand(2)}))}return Promise.reject()})).catch((function(e){return Promise.reject(e)}))}(t,i,r.factor):"3d"===e.type?h(t,3):h(t)}function h(e,t){return a.loadArcGISJSAPIModules(["esri/Graphic","esri/geometry/Extent","esri/geometry/Point"]).then((function(r){var a,n,o,s=null,u=e;a=r[0],n=r[1],o=r[2];try{if(u&&1===u.length&&u[0].geometry&&"esri.geometry.Multipoint"===u[0].geometry.declaredClass&&1===u[0].geometry.points.length){var c=u[0].geometry.points[0];u=[new a({geometry:new o({x:c[0],y:c[1],spatialReference:u[0].geometry.spatialReference})})]}if(u&&1===u.length&&u[0].geometry&&"esri.geometry.Point"===u[0].geometry.declaredClass){var p=u[0].geometry;s=new n({xmin:p.x-i.X,ymin:p.y-i.Y,xmax:p.x+i.X,ymax:p.y+i.Y,spatialReference:p.spatialReference})}else u&&u.length>0&&(s=function(e,t){if(!e||!e.length)return null;var r,i=null,a=e.length;for(r=0;r<a;r++){var n=e[r].geometry;if(n){var o=n.extent;o||"point"!==n.type||null==n.x||null==n.y||(o=new t({xmin:n.x,ymin:n.y,xmax:n.x,ymax:n.y,spatialReference:n.spatialReference})),o&&(i=i?i.union(o):o)}}if(!i||i.width<0||i.height<0)return null;return i}(u,n))&&t&&t>0&&(s=s.expand(t));return s}catch(e){return console.error(e),Promise.reject()}})).catch((function(e){return Promise.reject()}))}function y(e){var t=[];return e.map.basemap.baseLayers.forEach((function(e){e&&e.tileInfo&&e.tileInfo.lods&&t.length<e.tileInfo.lods.length&&(t=e.tileInfo.lods)})),0===t.length?o.create().lods:t}function m(e,t,r,i){var a,n=y(e),o=1;if(n){var s=[],u=[];n.forEach((function(e){t>0&&e.scale>t||(e.scale<r?u.push(e.scale):s.push(e.scale))})),s.reverse();var c=void 0;s.length>=1?(o=u.length?u.length/n.length:1,c=Math.floor((s.length-1)/(i/o)),a=s[c]):a=null}else a=0===t?null:(t-r)/i;return a}function g(e,t,r){var i,a=y(e);if(a){if(r){for(i=0;i<a.length;i++)if(a[i].scale<t)return a[i].scale-1;return a[a.length-1].scale-1}for(i=a.length-1;i>=0;i--)if(a[i].scale>t)return a[i].scale+1;return a[0].scale+1}return r?t-1:t+1}function w(e,t){var r=t.width*(e.size[1]/e.size[0])/5;return t.ymin=t.center.y-r,t.ymax=t.center.y+r,t}function v(e,t,r){return a.loadArcGISJSAPIModules(["esri/config","esri/geometry/support/WKIDUnitConversion"]).then((function(i){var a,n;a=i[0],n=i[1];var o,s,u=e.size[0],c=n,p=t.spatialReference;p&&(o=p.wkid,s=p.wkt);var d=null;if(o)d=c.values[c[o]];else if(s&&-1!==s.search(/^PROJCS/i)){var l=/UNIT\[([^\]]+)\]\]$/i.exec(s);l&&l[1]&&(d=parseFloat(l[1].split(",")[1]))}return t.expand(r*u/(39.37*(d||20015077/180)*(a.screenDPI||96))/t.width)})).catch((function(e){return Promise.reject()}))}t.zoomTo=function(e,t,r){return e&&t?(r||(r={}),a.loadArcGISJSAPIModules(["esri/Graphic","esri/geometry/Extent","esri/layers/Layer","esri/layers/support/TileInfo"]).then((function(i){var a,n,c;return a=i[0],n=i[1],c=i[2],o=i[3],t instanceof n?u(e,t,r.scale):Array.isArray(t)&&t.length&&t[0]instanceof a?function(e,t,r){if("3d"===e.type&&!r)return e.goTo(t);return f(e,t).then((function(t){return u(e,t,r)})).catch((function(e){return Promise.reject(e)}))}(e,t,r.scale):t instanceof c?s(e,t,null,null,r.scale):t.layer&&t.layer instanceof c&&t.extent&&t.extent instanceof n?s(e,t.layer,null,t.extent,r.scale):t.layer&&t.layer instanceof c&&Array.isArray(t.graphics)&&t.graphics.length&&t.graphics[0]instanceof a?s(e,t.layer,t.graphics,null,r.scale):Promise.reject(new Error("Invalid target."))}))):Promise.reject(new Error("Invalid target."))},function(e){e[e.X=1e-4]="X",e[e.Y=1e-4]="Y"}(i||(i={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0);t.checkDefaultBaseMapIsExist=function(){var e=i.getAppStore().getState().portalSelf;return!!(e&&e.defaultBasemap&&e.defaultBasemap.baseMapLayers&&e.defaultBasemap.baseMapLayers[0]&&e.defaultBasemap.baseMapLayers[0].url)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={layerIsNotSupported:"This layer type is not supported."}},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(12)),i(r(15)),i(r(16))},function(e,r){e.exports=t},function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(6),s=function(e){function t(t){var r=e.call(this,t)||this;r.viewManager=o.MapViewManager.getInstance(),r.onViewInfosChange=function(e,t){if(e){var i=r.getActiveViewId(),a=r.getViewIdsFromUseMapWidgetIds(t,e),n=r.getWhetherViewCreated(i,e),o=r.getWhetherAllViewsCreated(a,e);r.setState({activeViewId:i,isActiveViewCreated:n,areAllViewsCreated:o})}},r.onViewsCreate=function(e){e&&r.state.activeViewId&&Object.keys(e).some((function(e){return e===r.state.activeViewId}))&&r.setState({isActiveViewCreated:!0}),r.props.onViewsCreate&&r.props.onViewsCreate(e)},r.getActiveViewId=function(){var e=r.props.useMapWidgetIds&&r.props.useMapWidgetIds[0],t=r.viewManager.getJimuMapViewGroup(e),i=t&&t.getActiveJimuMapView();return i&&i.id||null},r.getWhetherAllViewsCreated=function(e,t){return void 0===e&&(e=[]),e.length>0&&!e.some((function(e){return!r.getWhetherViewCreated(e,t)}))},r.getWhetherViewCreated=function(e,t){return!e||!!(e&&t&&t[e]&&t[e].status&&t[e].status===n.JimuMapViewStatus.Loaded)},r.getViewIdsFromUseMapWidgetIds=function(e,t){var i=[];return e&&e.forEach((function(e){i=i.concat(r.getViewIdsFromMapWidgetId(e,t))})),i},r.getViewIdsFromMapWidgetId=function(e,t){return t?Object.keys(t).filter((function(r){return t[r].mapWidgetId===e})):[]},r.getViews=function(e){if(!e)return null;var t={};return e.forEach((function(e){t[e]=r.viewManager.getJimuMapViewById(e)})),t};var i=r.getViewIdsFromUseMapWidgetIds(r.props.useMapWidgetIds,r.props.viewInfos),a=r.getActiveViewId();return r.state={activeViewId:a,isActiveViewCreated:r.getWhetherViewCreated(a,r.props.viewInfos),areAllViewsCreated:r.getWhetherAllViewsCreated(i,r.props.viewInfos)},r}return a(t,e),t.prototype.componentDidMount=function(){if(this.onViewsCreate&&this.state.areAllViewsCreated){var e=this.getViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos),t=this.getViews(e);this.onViewsCreate(t)}if(this.props.onActiveViewChange&&this.state.isActiveViewCreated){var r=this.viewManager&&this.viewManager.getJimuMapViewById(this.state.activeViewId)||null;this.props.onActiveViewChange(r,null)}},t.prototype.componentDidUpdate=function(e,t){if(this.props.viewInfos===e.viewInfos&&this.props.useMapWidgetIds===e.useMapWidgetIds||this.onViewInfosChange(this.props.viewInfos,this.props.useMapWidgetIds),this.props.onActiveViewChange&&this.state.isActiveViewCreated&&(!t.isActiveViewCreated||this.state.activeViewId!==t.activeViewId)){var r=this.viewManager&&this.viewManager.getJimuMapViewById(this.state.activeViewId)||null;this.props.onActiveViewChange(r,t.activeViewId)}if(this.onViewsCreate&&this.state.areAllViewsCreated&&(!t.areAllViewsCreated||this.props.useMapWidgetIds!==e.useMapWidgetIds)){var i=this.getViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos),a=this.getViews(i);this.onViewsCreate(a)}},t.prototype.render=function(){if(!this.props.useMapWidgetIds||!this.props.viewInfos||!this.props.children)return null;var e=this.getViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos),t=this.getViews(e);return"function"==typeof this.props.children?this.props.children(t):this.props.children},t}(n.React.PureComponent);t.JimuMapViewComponent=n.ReactRedux.connect((function(e,t){return{viewInfos:e&&e.jimuMapViewsInfo}}))(s)},function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(6),s=function(e){function t(t){var r=e.call(this,t)||this;return r.getJimuMapViewIdsFromUseMapWidgetIds=function(e,t,i){var a=[];return e&&e.forEach((function(e){a=a.concat(r.getJimuMapViewIdsFromMapWidgetId(e,t,i))})),a},r.getJimuMapViewIdsFromMapWidgetId=function(e,t,r){return r&&t?Object.keys(t).filter((function(i){return t[i].mapWidgetId===e&&t[i].datasourceId===r})):[]},r}return a(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.getJimuMapViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos,this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.rootDatasourceId);if(t[0]&&this.props.viewInfos[t[0]].status===n.JimuMapViewStatus.Loaded&&this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.jimuMapViewId&&this.props.jimuLayerViewInfo.jimuLayerId){var r=o.MapViewManager.getInstance().getJimuMapViewById(t[0]).getJimuLayerViewLoadPromiseById(this.props.jimuLayerViewInfo.jimuMapViewId+"-"+this.props.jimuLayerViewInfo.jimuLayerId);r?r.then((function(t){e.props.onLayerViewCreated&&e.props.onLayerViewCreated(t)}),(function(t){e.props.onLayerViewFailed&&e.props.onLayerViewFailed(t)})):this.props.onLayerViewCreated&&this.props.onLayerViewCreated(null)}t[0]&&this.props.viewInfos[t[0]].status===n.JimuMapViewStatus.Failed&&this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.jimuMapViewId&&this.props.jimuLayerViewInfo.jimuLayerId&&this.props.onLayerViewFailed&&this.props.onLayerViewFailed(null)},t.prototype.componentDidUpdate=function(e,t){var r=this,i=this.getJimuMapViewIdsFromUseMapWidgetIds(e.useMapWidgetIds,e.viewInfos,e.jimuLayerViewInfo&&e.jimuLayerViewInfo.rootDatasourceId),a=e.viewInfos[i[0]],s=a&&a.status,u=this.getJimuMapViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos,this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.rootDatasourceId),c=this.props.viewInfos[u[0]],p=c&&c.status;if(s!==p||s===p&&i.join("")===u.join(""))if(c){if(c.status===n.JimuMapViewStatus.Loaded){var d=o.MapViewManager.getInstance().getJimuMapViewById(u[0]).getJimuLayerViewLoadPromiseById(this.props.jimuLayerViewInfo.jimuMapViewId+"-"+this.props.jimuLayerViewInfo.jimuLayerId);d?d.then((function(e){r.props.onLayerViewCreated&&r.props.onLayerViewCreated(e)}),(function(e){r.props.onLayerViewFailed&&r.props.onLayerViewFailed(e)})):this.props.onLayerViewCreated&&this.props.onLayerViewCreated(null)}c.status===n.JimuMapViewStatus.Failed&&this.props.onLayerViewFailed&&this.props.onLayerViewFailed(null)}else this.props.onLayerViewCreated&&this.props.onLayerViewCreated(null)},t.prototype.render=function(){return null},t}(n.React.PureComponent);t.JimuLayerViewComponent=n.ReactRedux.connect((function(e,t){return{viewInfos:e&&e.jimuMapViewsInfo}}))(s)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=function(){return Promise.resolve()}}])}));